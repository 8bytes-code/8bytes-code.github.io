<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;zh-TW&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MFC基础 | Box'Blog</title><meta name="author" content="Box"><meta name="copyright" content="Box"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="前言微软基础类库（英语：Microsoft Foundation Classes，简称MFC）是微软公司提供的一个类库（class libraries），以C++类的形式封装了Windows API，并且包含一个应用程序框架，以减少应用程序开发人员的工作量。其中包含大量Windows句柄封装类和很多Windows的内建控件和组件的封装类。">
<meta property="og:type" content="article">
<meta property="og:title" content="MFC基础">
<meta property="og:url" content="https://8bytes.top/2022/07/25/mfc01/index.html">
<meta property="og:site_name" content="Box&#39;Blog">
<meta property="og:description" content="前言微软基础类库（英语：Microsoft Foundation Classes，简称MFC）是微软公司提供的一个类库（class libraries），以C++类的形式封装了Windows API，并且包含一个应用程序框架，以减少应用程序开发人员的工作量。其中包含大量Windows句柄封装类和很多Windows的内建控件和组件的封装类。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://8bytes.top/images/cover/cover12.png">
<meta property="article:published_time" content="2022-07-25T04:36:44.000Z">
<meta property="article:modified_time" content="2022-11-12T12:59:54.270Z">
<meta property="article:author" content="Box">
<meta property="article:tag" content="MFC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://8bytes.top/images/cover/cover12.png"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="https://8bytes.top/2022/07/25/mfc01/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?112e257877c02bad314b2fcefaca0aee";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Box","link":"链接: ","source":"来源: Box'Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MFC基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-12 20:59:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="Box'Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/logo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">144</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/collect/"><i class="fa-fw fa fa-star"></i><span> 收藏</span></a></li><li><a class="site-page child" href="/photography/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/cover/cover12.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Box'Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/collect/"><i class="fa-fw fa fa-star"></i><span> 收藏</span></a></li><li><a class="site-page child" href="/photography/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MFC基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-25T04:36:44.000Z" title="发表于 2022-07-25 12:36:44">2022-07-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-12T12:59:54.270Z" title="更新于 2022-11-12 20:59:54">2022-11-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>68分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MFC基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>微软基础类库（英语：Microsoft Foundation Classes，简称MFC）是微软公司提供的一个类库（class libraries），以C++类的形式封装了Windows API，并且包含一个应用程序框架，以减少应用程序开发人员的工作量。其中包含大量Windows句柄封装类和很多Windows的内建控件和组件的封装类。</p>
<span id="more"></span>


<hr>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="MFC为何物"><a href="#MFC为何物" class="headerlink" title="MFC为何物"></a>MFC为何物</h2><p>传统手工业，需要很多人，然后手工去操作，对于厂家而言，人工费高，质量不确定。<br>而改用机器后，只需要投入材料，一天内的效应会大于人工，而且质量比较平均，当然不是所有的传统手工业都能被机器代替，只是部分。</p>
<p>这也就是普通c&#x2F;c++代码和api的区别，经过多次封装它自然就变得看起来简单，复用性高。</p>
<p>MFC既然是微软设计的，自然只适合在windows上做应用开发，像xp、win7、win10兼容性肯定没得说，毕竟也是个亲儿子。<br>不过目前的更新迭代之下，MFC的场景也会比较少，后面还有个跨平台的Qt。<br>虽然少，但是老公司的项目没有转型之前，大部分还是需要维护的。<br>可能外包比较多。</p>
<p>MFC的学习方式</p>
<ol>
<li>(1.c++多态、2.windows消息循环、3.msg loop)</li>
<li>查文档，不会就查，可以用vs的ide在函数上按f1跳转，也可以记网址</li>
</ol>
<p>安装：xxxx自己百度，vs的ide模块化其实看得很清楚了，就是吃内存。</p>
<blockquote>
<p>vs2022应该是C++ ATL for v143生成工具和c++ MFC for v143生成工具，都是x86和x64。</p>
</blockquote>
<p>MFC能做啥</p>
<ol>
<li>微软的基础框架</li>
<li>桌面应用</li>
<li>上位机</li>
<li>pc端的监控软件</li>
<li>修改注册表&#x2F;启动项等</li>
</ol>
<hr>
<h2 id="前身Win32"><a href="#前身Win32" class="headerlink" title="前身Win32"></a>前身Win32</h2><h3 id="1-窗口程序架构"><a href="#1-窗口程序架构" class="headerlink" title="1.窗口程序架构"></a>1.窗口程序架构</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">WinMain</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//设计窗口外观以及交互响应</span></span><br><span class="line">    <span class="built_in">RegisterClass</span>(...)</span><br><span class="line">    <span class="comment">//生产窗口</span></span><br><span class="line">    <span class="built_in">CreateWinodw</span>(...)</span><br><span class="line">    <span class="comment">//显示窗口</span></span><br><span class="line">    <span class="built_in">ShowWindow</span>(...)</span><br><span class="line">    <span class="comment">//刷新窗口</span></span><br><span class="line">    <span class="built_in">UpdateWindow</span>(...)</span><br><span class="line">    <span class="comment">//消息循环</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">GetMessage</span>(...))&#123;</span><br><span class="line">        <span class="comment">//消息转发</span></span><br><span class="line">        <span class="built_in">TranslateMessage</span>(...);</span><br><span class="line">        <span class="comment">//消息分发</span></span><br><span class="line">        <span class="built_in">DispatchMessage</span>(...);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-API和SDK"><a href="#2-API和SDK" class="headerlink" title="2.API和SDK"></a>2.API和SDK</h3><p>api全称(Application Program Interface) 应用程序编程接口<br>sdk全称(Software Development Kit) 也就是软件开发工具包，一般会包括API接口文档、示例文档、帮助文档、使用手册和相关工具。</p>
<hr>
<h3 id="3-窗口和句柄"><a href="#3-窗口和句柄" class="headerlink" title="3.窗口和句柄"></a>3.窗口和句柄</h3><p>窗口就是屏幕上的一片特定区域，可能存在等待接收用户的输入，显示程序的输出。可以包含标题栏、菜单栏、工具栏、空间等<br>句柄(handle)(资源的编号、二级指针)，窗口句柄、文件句柄、数据库连接句柄，本质都是指针<br>c++窗口类对象和窗口并不是一回事，二者的关系是c++窗口类内部定义了一个窗口句柄变量，保存了这个c++窗口类对象和相关的窗口句柄。当窗口销毁时，与之对应的c++窗口类对象销毁与否要看生命周期结束没。反之c++窗口类对象销毁时，与之相关的窗口肯定被销毁了。</p>
<hr>
<h3 id="4-消息循环"><a href="#4-消息循环" class="headerlink" title="4.消息循环"></a>4.消息循环</h3><img src="/2022/07/25/mfc01/000.png" class="">
<p>银行这种，一般都是个人业务比较多。取个号要么机器上操作，要么去柜台。</p>
<img src="/2022/07/25/mfc01/001.png" class="">
<p>对于windows系统而言，这种循环好看懂一些。</p>
<p>消息循环会引出一个<code>回调函数</code>。<br>就是说当出现特定事件的时候，都会交给回调函数处理。</p>
<hr>
<h3 id="5-变量命名约定"><a href="#5-变量命名约定" class="headerlink" title="5.变量命名约定"></a>5.变量命名约定</h3><table>
<thead>
<tr>
<th>前缀</th>
<th>含义</th>
<th>前缀</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>数组array</td>
<td>b</td>
<td>布尔值bool</td>
</tr>
<tr>
<td>by</td>
<td>无符号字符[字节]</td>
<td>c</td>
<td>字符[字节]</td>
</tr>
<tr>
<td>cb</td>
<td>字节计数</td>
<td>rgb</td>
<td>保存颜色值的长整型</td>
</tr>
<tr>
<td>cx，cy</td>
<td>短整型[计算x，y的长度]</td>
<td>dw</td>
<td>无符号长整型</td>
</tr>
<tr>
<td>fn</td>
<td>函数</td>
<td>h</td>
<td>句柄</td>
</tr>
<tr>
<td>i</td>
<td>整型</td>
<td>m_</td>
<td>类的数据成员member</td>
</tr>
<tr>
<td>n</td>
<td>短整型或整型</td>
<td>np</td>
<td>近指针</td>
</tr>
<tr>
<td>p</td>
<td>指针</td>
<td>l</td>
<td>长整型</td>
</tr>
<tr>
<td>lp</td>
<td>长指针</td>
<td>s</td>
<td>字符串string</td>
</tr>
<tr>
<td>sz</td>
<td>以0结尾的字符串</td>
<td>tm</td>
<td>正文大小</td>
</tr>
<tr>
<td>w</td>
<td>无符号整型</td>
<td>x，y</td>
<td>无符号整型[表示x，y的坐标]</td>
</tr>
</tbody></table>
<p>反正windows的产品基本都遵循这样的命名规范。</p>
<hr>
<h2 id="MFC程序开发流程"><a href="#MFC程序开发流程" class="headerlink" title="MFC程序开发流程"></a>MFC程序开发流程</h2><hr>
<h3 id="1-基于对话框的程序"><a href="#1-基于对话框的程序" class="headerlink" title="1.基于对话框的程序"></a>1.基于对话框的程序</h3><p>无菜单栏、工具栏，界面很简单，可使用此类型为对话框。</p>
<img src="/2022/07/25/mfc01/004.png" class="">
<p>类似于计算器这种</p>
<hr>
<h3 id="2-基于文档-x2F-试图的程序"><a href="#2-基于文档-x2F-试图的程序" class="headerlink" title="2.基于文档&#x2F;试图的程序"></a>2.基于文档&#x2F;试图的程序</h3><p>标准的windows应用界面，包含菜单栏、工具栏、状态栏等。</p>
<img src="/2022/07/25/mfc01/005.png" class="">
<p>最直观的就是vs的ide喽</p>
<hr>
<h3 id="3-MFC与win32开发的区别"><a href="#3-MFC与win32开发的区别" class="headerlink" title="3.MFC与win32开发的区别"></a>3.MFC与win32开发的区别</h3><ul>
<li>定制界面的区别(手写代码和拖放控件)</li>
<li>响应键鼠操作的区别(窗口处理函数和消息映射机制)</li>
</ul>
<p>win32可以开发纯命令行的程序，也就是windows所说的dos，在命令行里面gcc cmake之类的操作。<br>所以涉及到界面的开发自然而然的是选择MFC。</p>
<hr>
<h3 id="4-MFC消息映射机制"><a href="#4-MFC消息映射机制" class="headerlink" title="4.MFC消息映射机制"></a>4.MFC消息映射机制</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">BEGIN_MESSAGE_MAP</span>(CMFCApplication1Dlg, CDialogEx)</span><br><span class="line">	<span class="built_in">ON_WM_SYSCOMMAND</span>()</span><br><span class="line">	<span class="built_in">ON_WM_PAINT</span>()</span><br><span class="line">	<span class="built_in">ON_WM_QUERYDRAGICON</span>()</span><br><span class="line"><span class="built_in">END_MESSAGE_MAP</span>()</span><br></pre></td></tr></table></figure>
<p><code>BEGIN_MESSAGE_MAP</code>即为消息映射表<br>如果有特殊需求也可以进行自定义消息。虽然不能说自定义就一定能达到需求。</p>
<hr>
<h3 id="5-构建项目"><a href="#5-构建项目" class="headerlink" title="5.构建项目"></a>5.构建项目</h3><p>vs有默认的项目类型可选，是提高效率的首要之选，不是说不可以从空项目起手，而是节约基础配置的时间。</p>
<img src="/2022/07/25/mfc01/002.png" class="">
<img src="/2022/07/25/mfc01/003.png" class="">
<img src="/2022/07/25/mfc01/006.png" class="">

<p>至于共享dll编译出来的exe体积肯定是比使用静态库的exe要小。</p>
<img src="/2022/07/25/mfc01/007.png" class="">
<p>默认就共享得了。有需要在使用静态。<br>然后此处基于对话框开发，所以文档模板属性没啥可选的。</p>
<img src="/2022/07/25/mfc01/008.png" class="">
<p>用户界面常用的最小化最大化是可以勾上的，标题名呢也可以在此就设置好。</p>
<img src="/2022/07/25/mfc01/009.png" class="">
<p>这些也可以看着来。</p>
<p>最后的生成的类一般不做修改。也别闲着用中文，每个人的环境不同，编码有异，在你这能跑在别人那就可能乱码了。</p>
<p>创建完成之后</p>
<img src="/2022/07/25/mfc01/010.png" class="">
<p>其实就能看到大致的模板了。</p>
<img src="/2022/07/25/mfc01/011.png" class="">
<p>跟预览的效果是一样的。这种直接套模板的确省去了不少麻烦。</p>
<blockquote>
<p>其中拖动控件的精髓在工具箱里，属性里面直接选消息。</p>
</blockquote>
<hr>
<h2 id="画线"><a href="#画线" class="headerlink" title="画线"></a>画线</h2><ul>
<li>知识点<ul>
<li>屏幕坐标和客户端坐标</li>
<li>设备上下文</li>
<li>事件</li>
</ul>
</li>
<li>起点和终点<ul>
<li>如何捕捉这两点，如左键为起点右键为终点</li>
</ul>
</li>
</ul>
<p>这次选择基于单个文档，其它倒是不用太在意</p>
<p>在创建完项目后看到很多头文件和源文件的时候，可以通过菜单栏的视图找到类视图</p>
<img src="/2022/07/25/mfc01/012.png" class="">
<p>能够主要看清有哪些类。</p>
<p>启动项目后可以看到这样一个模板</p>
<img src="/2022/07/25/mfc01/013.png" class="">
<p>要自己一开始就写肯定是不行的，所以这就是项目模板的好处，可以帮你完成很多基础的操作。<br>至于实现部分，可以通过类视图的类名去得到大意。</p>
<p>至于画线部分，拆分为两个地方，起点就是我们鼠标左键按下确定第一个点，然后随便他怎么拖动到其他地方然后再点击一下，即为线的终点。</p>
<p>至于这些鼠标按下抬起的消息，可以通过类视图右击打开属性，找到消息，能看到有很多。</p>
<img src="/2022/07/25/mfc01/014.png" class="">
<img src="/2022/07/25/mfc01/015.png" class="">
<p>然后选择这俩</p>
<img src="/2022/07/25/mfc01/016.png" class="">
<p>也就是left button up和left button up，按下和松开</p>
<p>至于形参，可以转到定义查看<br><code>typedef unsigned int        UINT;</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CPoint</span> :</span><br><span class="line">	<span class="keyword">public</span> tagPOINT</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// Constructors</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// create an uninitialized point</span></span><br><span class="line">	<span class="built_in">CPoint</span>() <span class="keyword">throw</span>();</span><br><span class="line">	<span class="comment">// create from two integers</span></span><br><span class="line">	<span class="built_in">CPoint</span>(</span><br><span class="line">		_In_ <span class="type">int</span> initX,</span><br><span class="line">		_In_ <span class="type">int</span> initY) <span class="keyword">throw</span>();</span><br><span class="line">	<span class="comment">// create from another point</span></span><br><span class="line">	<span class="built_in">CPoint</span>(_In_ POINT initPt) <span class="keyword">throw</span>();</span><br><span class="line">	<span class="comment">// create from a size</span></span><br><span class="line">	<span class="built_in">CPoint</span>(_In_ SIZE initSize) <span class="keyword">throw</span>();</span><br><span class="line">	<span class="comment">// create from an LPARAM: x = LOWORD(dw) y = HIWORD(dw)</span></span><br><span class="line">	<span class="built_in">CPoint</span>(_In_ LPARAM dwPoint) <span class="keyword">throw</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Operations</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// translate the point</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Offset</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		_In_ <span class="type">int</span> xOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">		_In_ <span class="type">int</span> yOffset)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Offset</span><span class="params">(_In_ POINT point)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Offset</span><span class="params">(_In_ SIZE size)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetPoint</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		_In_ <span class="type">int</span> X,</span></span></span><br><span class="line"><span class="params"><span class="function">		_In_ <span class="type">int</span> Y)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	BOOL <span class="keyword">operator</span>==(_In_ POINT point) <span class="type">const</span> <span class="built_in">throw</span>();</span><br><span class="line">	BOOL <span class="keyword">operator</span>!=(_In_ POINT point) <span class="type">const</span> <span class="built_in">throw</span>();</span><br><span class="line">	<span class="type">void</span> <span class="keyword">operator</span>+=(_In_ SIZE size) <span class="built_in">throw</span>();</span><br><span class="line">	<span class="type">void</span> <span class="keyword">operator</span>-=(_In_ SIZE size) <span class="built_in">throw</span>();</span><br><span class="line">	<span class="type">void</span> <span class="keyword">operator</span>+=(_In_ POINT point) <span class="built_in">throw</span>();</span><br><span class="line">	<span class="type">void</span> <span class="keyword">operator</span>-=(_In_ POINT point) <span class="built_in">throw</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Operators returning CPoint values</span></span><br><span class="line">	CPoint <span class="keyword">operator</span>+(_In_ SIZE size) <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	CPoint <span class="keyword">operator</span>-(_In_ SIZE size) <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	CPoint <span class="keyword">operator</span>-() <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	CPoint <span class="keyword">operator</span>+(_In_ POINT point) <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Operators returning CSize values</span></span><br><span class="line">	CSize <span class="keyword">operator</span>-(_In_ POINT point) <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Operators returning CRect values</span></span><br><span class="line">	CRect <span class="keyword">operator</span>+(_In_ <span class="type">const</span> RECT* lpRect) <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">	CRect <span class="keyword">operator</span>-(_In_ <span class="type">const</span> RECT* lpRect) <span class="function"><span class="type">const</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>一个是改了名的类型，一个则是类。</p>
<p>这个类中有两个字眼比较醒目，x和y。变相的能猜到肯定是记录了xy轴的坐标。<br>但是按住和松开肯定是会改变xy的，就需要自己定义两个变量去记录起始位置。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	CPoint m_start;		<span class="comment">//起始位置，用于绘制线条</span></span><br><span class="line">	CPoint m_stop;		<span class="comment">//终止位置，用于绘制线条</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_start = point;</span><br><span class="line">    CView::<span class="built_in">OnLButtonDown</span>(nFlags, point);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonUp</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_stop = point;</span><br><span class="line">	CView::<span class="built_in">OnLButtonUp</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这打两个断点然后跑程序，随便点击一下，就能看到point的xy出现值了</p>
<img src="/2022/07/25/mfc01/017.png" class="">

<p>然而坐标其实也有分别，像屏幕传统的都是1920*1080，说的就是x轴长1920，y轴长1080，而且比较有意思的是这个0，0坐标在屏幕的左上角。<br>屏幕坐标可称为screen point，而程序的坐标可称为client point。</p>
<p>有了这两个的区别，就可能导致获取到的xy坐标是有问题的。<br>除了基础的xy获取了之后，还要考虑这个信息会不会被其它消息所引用，有引用又得防着被修改了。</p>
<p>xy有了，那么要考虑绘制的问题。<br>要用到一个类<code>CDC</code><br>这里就不展示了，这个类的定义里面东西有点多。</p>
<p><code>// The device context</code>在注释中说明，这是一个设备的上下文<br>上下文：在画图中要绘制一些东西的时候，肯定会用到线条的粗细，线条的颜色，画图的大小，画图的大小状态比如最小化最大化和普通状态等许多参数信息，只有了解了所有的参数信息才能绘制出想要的东西。<br>为什么叫设备上下文：上述举例的上下文是属于窗口的上下文，而有其他的情况，你会把绘制的东西显示在显示器上，而不是单独的窗口。那么这种时候就需要获取到你这个屏幕的参数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonUp</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_stop = point;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取设备上下文</span></span><br><span class="line">	CDC *pDC = <span class="built_in">GetDC</span>();</span><br><span class="line">	pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnLButtonUp</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在c++中结构体和类基本功能相通，区别在于类有私有成员。所以传递类并没有太大关系。<br><code>pDC-&gt;MoveTo(m_start);</code><br>moveto 就是说移动到我们的这个点上。然后才可以进行绘制线条之类的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonUp</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_stop = point;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取设备上下文</span></span><br><span class="line">	CDC *pDC = <span class="built_in">GetDC</span>();</span><br><span class="line">	pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">	pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line">	<span class="built_in">ReleaseDC</span>(pDC);</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnLButtonUp</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>pDC-&gt;LineTo(m_stop);</code>line就是线呗，从按下鼠标左键的点到松开的点直接绘制一条直线。<br>并且要记住<code>ReleaseDC(pDC);</code>，避免占用导致程序异常。</p>
<p>然后就可以run了</p>
<img src="/2022/07/25/mfc01/018.png" class="">
<p>鼠标左键按下直到某个点松开即可绘制出线条。</p>
<p>多画几条也没事，不过有点踩坑点：就是重绘的问题，此处就是当最大化和最小化的时候线条就莫得了。</p>
<p>除此之外，每次都需要滑动才能绘制，可能有点low。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	CPoint m_start;		<span class="comment">//起始位置，用于绘制线条</span></span><br><span class="line">	CPoint m_stop;		<span class="comment">//终止位置，用于绘制线条</span></span><br><span class="line">	BOOL m_status;		<span class="comment">//绘制状态</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_start = point;</span><br><span class="line">	m_status = TRUE;</span><br><span class="line">    CView::<span class="built_in">OnLButtonDown</span>(nFlags, point);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonUp</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_stop = point;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取设备上下文</span></span><br><span class="line">	CDC *pDC = <span class="built_in">GetDC</span>();</span><br><span class="line">	pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">	pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line">	<span class="built_in">ReleaseDC</span>(pDC);</span><br><span class="line">	m_status = FALSE;</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnLButtonUp</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后新增消息，鼠标移动时。快捷操作就是类视图然后属性里面找到消息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnMouseMove</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;</span><br><span class="line">		<span class="built_in">InvalidateRect</span>(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//如果鼠标正在移动就进行操作</span></span><br><span class="line">		CDC *pDC = <span class="built_in">GetDC</span>();</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line">		<span class="built_in">ReleaseDC</span>(pDC);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnMouseMove</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>增加一个状态是为了考虑程序刚启动的时候鼠标可能就在绘制区域了，那么有可能m_start没能获取到值，那么后面的绘制就会出现一些问题。</p>
<p><strong>注：状态肯定要在构造函数里面初始化</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMFCPaintView::<span class="built_in">CMFCPaintView</span>() <span class="keyword">noexcept</span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处添加构造代码</span></span><br><span class="line">	m_status = FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InvalidateRect(NULL);</code>的作用<br>加了这个之后虽然绘制的线条没有刷新了，但是会接住前面的鼠标释放的点。看似连贯但是效果不对。<br>而没加这个，则是无论画多少条线都只会显示最近一次画的，也就是传统说法被刷新了或者叫重绘。</p>
<p>为了保证安全，再多加一个当前点位的变量。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CMFCPaintView::<span class="built_in">CMFCPaintView</span>() <span class="keyword">noexcept</span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处添加构造代码</span></span><br><span class="line">	m_status = FALSE;</span><br><span class="line">	m_start = &#123; <span class="number">0</span>,<span class="number">0</span> &#125;;</span><br><span class="line">	m_stop = &#123; <span class="number">0</span>,<span class="number">0</span> &#125;;</span><br><span class="line">	m_cur = &#123; <span class="number">0</span>,<span class="number">0</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反正构造函数不要浪费，避免不必要的错误，就都从0，0坐标开始初始化。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_start = point;</span><br><span class="line">	m_status = TRUE;</span><br><span class="line">    CView::<span class="built_in">OnLButtonDown</span>(nFlags, point);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnLButtonUp</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	m_stop = point;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取设备上下文</span></span><br><span class="line">	CDC *pDC = <span class="built_in">GetDC</span>();</span><br><span class="line">	pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">	pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line">	<span class="built_in">ReleaseDC</span>(pDC);</span><br><span class="line">	m_status = FALSE;</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnLButtonUp</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按下和释放不需要怎么改动。</p>
<p>在鼠标移动消息中</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnMouseMove</span><span class="params">(UINT nFlags, CPoint point)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;</span><br><span class="line">		<span class="built_in">InvalidateRect</span>(<span class="literal">NULL</span>);</span><br><span class="line">		m_cur = point;			<span class="comment">//让m_cur = 当前的鼠标坐标。</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnMouseMove</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至于这个刷新，它会自动触发函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_cur);</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面的绘图代码才是我们需要添加的，前面不用管，前面的就是相当于一个刷新白板的操作。<br>也就是我们之前提到过的，最大化和最小化的时候，之前画的线条就消失了，其实就是触发了重绘没有保存。</p>
<p><code>InvalidateRect</code>会调用<code>OnDraw</code>，在我们没有重写<code>OnDraw</code>的时候，默认操作就是重绘白板。</p>
<p>一个m_start和m_stop和m_cur只能完整的记录一条线。如果想要画多条，就要用到列表方式去控制。</p>
<hr>
<h2 id="画笔"><a href="#画笔" class="headerlink" title="画笔"></a>画笔</h2><p>之前的画线，它的粗细和颜色和形状都不能调整。所以可以尝试修改这些。</p>
<p>用画笔自然也要用它封装好的类，CPen</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CPen</span> : <span class="keyword">public</span> CGdiObject</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">DECLARE_DYNAMIC</span>(CPen)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">static</span> CPen* PASCAL <span class="title">FromHandle</span><span class="params">(HPEN hPen)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constructors</span></span><br><span class="line">	<span class="built_in">CPen</span>();</span><br><span class="line">	<span class="built_in">CPen</span>(<span class="type">int</span> nPenStyle, <span class="type">int</span> nWidth, COLORREF crColor);</span><br><span class="line">	<span class="built_in">CPen</span>(<span class="type">int</span> nPenStyle, <span class="type">int</span> nWidth, <span class="type">const</span> LOGBRUSH* pLogBrush,</span><br><span class="line">		<span class="type">int</span> nStyleCount = <span class="number">0</span>, <span class="type">const</span> DWORD* lpStyle = <span class="literal">NULL</span>);</span><br><span class="line">	<span class="function">BOOL <span class="title">CreatePen</span><span class="params">(<span class="type">int</span> nPenStyle, <span class="type">int</span> nWidth, COLORREF crColor)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreatePen</span><span class="params">(<span class="type">int</span> nPenStyle, <span class="type">int</span> nWidth, <span class="type">const</span> LOGBRUSH* pLogBrush,</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="type">int</span> nStyleCount = <span class="number">0</span>, <span class="type">const</span> DWORD* lpStyle = <span class="literal">NULL</span>)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreatePenIndirect</span><span class="params">(LPLOGPEN lpLogPen)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attributes</span></span><br><span class="line">	<span class="function"><span class="keyword">operator</span> <span class="title">HPEN</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">GetLogPen</span><span class="params">(LOGPEN* pLogPen)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">GetExtLogPen</span><span class="params">(EXTLOGPEN* pLogPen)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CPen</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Dump</span><span class="params">(CDumpContext&amp; dc)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里看到构造的时候有两个带参数了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CPen</span>(<span class="type">int</span> nPenStyle, <span class="type">int</span> nWidth, COLORREF crColor);</span><br><span class="line"><span class="built_in">CPen</span>(<span class="type">int</span> nPenStyle, <span class="type">int</span> nWidth, <span class="type">const</span> LOGBRUSH* pLogBrush,</span><br><span class="line">	<span class="type">int</span> nStyleCount = <span class="number">0</span>, <span class="type">const</span> DWORD* lpStyle = <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<p>刚学先用前者<br>style就是样式，那么具体有</p>
<ol>
<li>PS_SOLID    实线</li>
<li>PS_DASH    虚线</li>
<li>PS_DOT    点线</li>
<li>PS_DOTDASH    点划线</li>
</ol>
<p>转到定义之后注释其实也很详细的给出了样子</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PS_SOLID            0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_DASH             1       <span class="comment">/* -------  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_DOT              2       <span class="comment">/* .......  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_DASHDOT          3       <span class="comment">/* _._._._  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_DASHDOTDOT       4       <span class="comment">/* _.._.._  */</span></span></span><br></pre></td></tr></table></figure>

<p>width自然就是线宽了，一般的单位都是像素。传int就完事。<br>color颜色，表示起来就RGB(RED,GREE,BULR)按照ps那会的情况，数值应该是0-255，暂时没看这里能不能用十六进制的方式塞。</p>
<p>设置好了笔的属性，就该用这支笔去画。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(PS_DASH, <span class="number">3</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CPen *pPen = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;pen);		<span class="comment">//要把这个笔加入设备上下文</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_cur);</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//还原笔的属性是为了保证后面要画的时候不会还是这个类型</span></span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pPen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/019.png" class="">
<p>可以看到粗细和颜色是有变化了，但是样式好像没看出变化。<br>越来越粗的话肯定是看不出变化的。那么改小一点<br><code>CPen pen(PS_DASH, 1, RGB(255, 0, 0));</code></p>
<img src="/2022/07/25/mfc01/020.png" class="">
<p>可以看到了虚线效果。。。嘶，还挺麻烦。只能用一个像素点才能看到效果。</p>
<hr>
<h3 id="TRACE"><a href="#TRACE" class="headerlink" title="TRACE"></a>TRACE</h3><p>这是一个调试的时候用的函数，可以在输出栏里面打印出一些需要的信息。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(PS_DASH, <span class="number">4</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CPen *pPen = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;pen);</span><br><span class="line"></span><br><span class="line">	LOGPEN logpen;</span><br><span class="line">	pPen-&gt;<span class="built_in">GetLogPen</span>(&amp;logpen);</span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;\nstyle:%d width:%d color:%08X\n&quot;</span>, logpen.lopnStyle, logpen.lopnWidth, logpen.lopnColor);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;	</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_cur);</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">MoveTo</span>(m_start);</span><br><span class="line">		pDC-&gt;<span class="built_in">LineTo</span>(m_stop);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//还原笔的属性是为了保证后面要画的时候不会还是这个类型</span></span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pPen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/021.png" class="">

<p>毕竟有的时候单步调试比较累，如果能隐约猜到，可以尝试打印看看是否有问题。</p>
<hr>
<h2 id="画刷"><a href="#画刷" class="headerlink" title="画刷"></a>画刷</h2><p>用过画图其实应该知道，画笔毕竟画的是点阵练成的线，而画刷画出来的是实心的对象。<br>一个点绘，一个填充。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CBrush</span> : <span class="keyword">public</span> CGdiObject</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">DECLARE_DYNAMIC</span>(CBrush)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">static</span> CBrush* PASCAL <span class="title">FromHandle</span><span class="params">(HBRUSH hBrush)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constructors</span></span><br><span class="line">	<span class="built_in">CBrush</span>();</span><br><span class="line">	<span class="built_in">CBrush</span>(COLORREF crColor);             <span class="comment">// CreateSolidBrush</span></span><br><span class="line">	<span class="built_in">CBrush</span>(<span class="type">int</span> nIndex, COLORREF crColor); <span class="comment">// CreateHatchBrush</span></span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">CBrush</span><span class="params">(CBitmap* pBitmap)</span></span>;          <span class="comment">// CreatePatternBrush</span></span><br><span class="line"></span><br><span class="line">	<span class="function">BOOL <span class="title">CreateSolidBrush</span><span class="params">(COLORREF crColor)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreateHatchBrush</span><span class="params">(<span class="type">int</span> nIndex, COLORREF crColor)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreateBrushIndirect</span><span class="params">(<span class="type">const</span> LOGBRUSH* lpLogBrush)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreatePatternBrush</span><span class="params">(CBitmap* pBitmap)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreateDIBPatternBrush</span><span class="params">(HGLOBAL hPackedDIB, UINT nUsage)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreateDIBPatternBrush</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* lpPackedDIB, UINT nUsage)</span></span>;</span><br><span class="line">	<span class="function">BOOL <span class="title">CreateSysColorBrush</span><span class="params">(<span class="type">int</span> nIndex)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attributes</span></span><br><span class="line">	<span class="function"><span class="keyword">operator</span> <span class="title">HBRUSH</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">GetLogBrush</span><span class="params">(LOGBRUSH* pLogBrush)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CBrush</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Dump</span><span class="params">(CDumpContext&amp; dc)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>CBrush即为c++中的画刷。而构造函数里面，有个是就放颜色就行的。</p>
<p>起步都一样，创建了之后添加到设备上下文。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(PS_DASH, <span class="number">4</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CPen *pPen = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;pen);</span><br><span class="line"></span><br><span class="line">	<span class="function">CBrush <span class="title">brush</span><span class="params">(RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CBrush *pBrush = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;brush);</span><br><span class="line"></span><br><span class="line">	LOGPEN logpen;</span><br><span class="line">	pPen-&gt;<span class="built_in">GetLogPen</span>(&amp;logpen);</span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;\nstyle:%d width:%d color:%08X\n&quot;</span>, logpen.lopnStyle, logpen.lopnWidth, logpen.lopnColor);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;	</span><br><span class="line"><span class="comment">// 		pDC-&gt;MoveTo(m_start);</span></span><br><span class="line"><span class="comment">// 		pDC-&gt;LineTo(m_cur);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充矩形</span></span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_cur), &amp;brush);</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// 		pDC-&gt;MoveTo(m_start);</span></span><br><span class="line"><span class="comment">// 		pDC-&gt;LineTo(m_stop);</span></span><br><span class="line"></span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_stop), &amp;brush);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//还原笔的属性是为了保证后面要画的时候不会还是这个类型</span></span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pPen);</span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pBrush);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2022/07/25/mfc01/022.png" class="">
<p>其实就是从按下到释放的两个点延伸出去直至闭合形成一个图形。<br>至于填充的颜色，画刷初始化的时候选择绿色，则默认也为绿色，也就是说<code>pDC-&gt;FillRect(CRect(m_start, m_cur), &amp;brush);</code>后面的参数不选择画刷，用NULL，默认的颜色也是画刷的颜色。<br>也可以创建别的颜色的画刷对象，然后传递，这倒不是啥大问题。</p>
<p><code>FillRect</code>是填充矩形，那么还有别的几个，下次再整。</p>
<img src="/2022/07/25/mfc01/023.png" class="">

<hr>
<h2 id="光标和文本"><a href="#光标和文本" class="headerlink" title="光标和文本"></a>光标和文本</h2><p>我们现在跑的这个mfc程序，虽然中间那个空白区域是一个编辑区域，但是前面的功能都是绘制，与传统本文编辑区域而言，他少了一个光标，还有行号或者是分层的感觉。</p>
<p>至于这个创建光标加在哪里，构造函数肯定不可行，因为窗口绑定有很多相关的东西，不代表你这个地方构造完成了，其它绑定窗口的东西并不一定全部起来了。放在ondraw里面也不合适，那里重绘的话太频繁了这个光标。</p>
<p>所有的windows程序和mfc程序<br>第一阶段都是构造的时候<br>第二阶段才到达create阶段，在这个时候才会把构造的对象和窗口句柄之类的绑定<br>第三阶段要么showWindow或者doModule，就是显示出这些程序的框架，也就是跑起来了<br>第四阶段大致就是destroy阶段，它这个时候就是去销毁掉窗口<br>第五阶段就是delete阶段，这个时候才是销毁掉构造的对象</p>
<p>所以构造什么的是肯定行不通了，就要用到Create消息<br>快捷操作就是类视图，选择CMFCPaintView，然后属性里面找到消息，选择create</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">CMFCPaintView::OnCreate</span><span class="params">(LPCREATESTRUCT lpCreateStruct)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( CView::<span class="built_in">OnCreate</span>(lpCreateStruct) == <span class="number">-1</span> )</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span>  在此添加您专用的创建代码</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就会得到这样一个模板。这个create消息是create完成之后广播到各个控件，然后调用自己的构造函数，然后去完成一些自定义的操作。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">CMFCPaintView::OnCreate</span><span class="params">(LPCREATESTRUCT lpCreateStruct)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( CView::<span class="built_in">OnCreate</span>(lpCreateStruct) == <span class="number">-1</span> )</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span>  在此添加您专用的创建代码</span></span><br><span class="line">	<span class="built_in">CreateSolidCaret</span>(<span class="number">3</span>, <span class="number">20</span>);</span><br><span class="line">	<span class="built_in">ShowCaret</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在随便指定这个光标大小之后</p>
<img src="/2022/07/25/mfc01/024.png" class="">
<p>截图所以不管他闪不闪了，不过因为这个数值是我们指定的，所以当输入的字体万一大于光标或者小于都会看着很奇怪，显然别的程序肯定是有自适应大小的解决方法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">CMFCPaintView::OnCreate</span><span class="params">(LPCREATESTRUCT lpCreateStruct)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( CView::<span class="built_in">OnCreate</span>(lpCreateStruct) == <span class="number">-1</span> )</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span>  在此添加您专用的创建代码</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	TEXTMETRIC tm;</span><br><span class="line">	dc.<span class="built_in">GetTextMetrics</span>(&amp;tm);</span><br><span class="line">	<span class="built_in">CreateSolidCaret</span>(<span class="number">2</span>, tm.tmHeight);</span><br><span class="line">	<span class="built_in">ShowCaret</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用了点稀奇古怪的感觉</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">tagTEXTMETRICW</span></span><br><span class="line">&#123;</span><br><span class="line">    LONG        tmHeight;</span><br><span class="line">    LONG        tmAscent;</span><br><span class="line">    LONG        tmDescent;</span><br><span class="line">    LONG        tmInternalLeading;</span><br><span class="line">    LONG        tmExternalLeading;</span><br><span class="line">    LONG        tmAveCharWidth;</span><br><span class="line">    LONG        tmMaxCharWidth;</span><br><span class="line">    LONG        tmWeight;</span><br><span class="line">    LONG        tmOverhang;</span><br><span class="line">    LONG        tmDigitizedAspectX;</span><br><span class="line">    LONG        tmDigitizedAspectY;</span><br><span class="line">    WCHAR       tmFirstChar;</span><br><span class="line">    WCHAR       tmLastChar;</span><br><span class="line">    WCHAR       tmDefaultChar;</span><br><span class="line">    WCHAR       tmBreakChar;</span><br><span class="line">    BYTE        tmItalic;</span><br><span class="line">    BYTE        tmUnderlined;</span><br><span class="line">    BYTE        tmStruckOut;</span><br><span class="line">    BYTE        tmPitchAndFamily;</span><br><span class="line">    BYTE        tmCharSet;</span><br><span class="line">&#125; TEXTMETRICW, *PTEXTMETRICW, NEAR *NPTEXTMETRICW, FAR *LPTEXTMETRICW;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="keyword">typedef</span> TEXTMETRICW TEXTMETRIC;</span><br></pre></td></tr></table></figure>
<p>反正传入这个的目的就是为了获取到里面的hight。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CClientDC</span> : <span class="keyword">public</span> CDC</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">DECLARE_DYNAMIC</span>(CClientDC)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constructors</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">CClientDC</span><span class="params">(CWnd* pWnd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attributes</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	HWND m_hWnd;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CClientDC</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">AssertValid</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Dump</span><span class="params">(CDumpContext&amp; dc)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>显然这个类是继承CDC的一个派生类，那么这个派生类也能拿到基类的设备上下文了。</p>
<p>跑起来之后反正目前看上去差别不大。</p>
<p>光标位置有了，就是输入的时候</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnChar</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnChar</span>(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这玩意也比较有意思。<br>当我们在输出的地方打印这个uChar的时候</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnChar</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%c\r\n&quot;</span>, nChar);</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnChar</span>(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/025.png" class="">
<p>也就是每当键盘按下一个键，他就会接收到。既然它能接收到，那就好办了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnChar</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%c\r\n&quot;</span>, nChar);</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	m_strText += (TCHAR)nChar;</span><br><span class="line">	dc.<span class="built_in">TextOut</span>(<span class="number">0</span>, <span class="number">0</span>, m_strText);</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnChar</span>(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写入肯定还是要获取设备上下文的，然后就是TextOut的最后一个参数是Cstring，在这里创建临时变量的话，也不能保证后面别的地方会不会用到，就干脆在类里面新建一个成员保存。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	CPoint m_start;		<span class="comment">//起始位置，用于绘制线条</span></span><br><span class="line">	CPoint m_cur;		<span class="comment">//当前点位，用于绘制线条</span></span><br><span class="line">	CPoint m_stop;		<span class="comment">//终止位置，用于绘制线条</span></span><br><span class="line">	BOOL m_status;		<span class="comment">//绘制状态</span></span><br><span class="line">	CString m_strText;	<span class="comment">//用户输出的字符串</span></span><br></pre></td></tr></table></figure>
<p>这里<code>m_strText += (TCHAR)nChar;</code>转换是因为vs2022反正项目默认都是unicode编码的也就是宽字节，所有的字符占两个字节，而多字节也就是ANSI，在ANSI中英文占用一个字节，所以二者会有区别。这也是有的时候要么改编码环境要么强转。</p>
<p>跑起来试试</p>
<img src="/2022/07/25/mfc01/026.png" class="">

<p>可以看到还是有点问题，比如这个光标不移动，还要每次输入闪烁很明显，闪烁肯定是重绘的问题。<br>所以在重绘函数ondraw里面来一次textout就行</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(PS_DASH, <span class="number">4</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CPen *pPen = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;pen);</span><br><span class="line">	<span class="function">CBrush <span class="title">brush</span><span class="params">(RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CBrush *pBrush = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;brush);</span><br><span class="line"></span><br><span class="line">	LOGPEN logpen;</span><br><span class="line">	pPen-&gt;<span class="built_in">GetLogPen</span>(&amp;logpen);</span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;\nstyle:%d width:%d color:%08X\n&quot;</span>, logpen.lopnStyle, logpen.lopnWidth, logpen.lopnColor);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;	</span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_cur), &amp;brush);</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_stop), &amp;brush);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//还原笔的属性是为了保证后面要画的时候不会还是这个类型</span></span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pPen);</span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pBrush);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//重绘字符串</span></span><br><span class="line">	pDC-&gt;<span class="built_in">TextOut</span>(<span class="number">0</span>, <span class="number">0</span>, m_strText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在onchar消息里面刷新</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnChar</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%c\r\n&quot;</span>, nChar);</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	m_strText += (TCHAR)nChar;</span><br><span class="line">	dc.<span class="built_in">TextOut</span>(<span class="number">0</span>, <span class="number">0</span>, m_strText);</span><br><span class="line">	<span class="built_in">InvalidateRect</span>(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	CView::<span class="built_in">OnChar</span>(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>闪烁问题就解决了。</p>
<p><strong>另外测试的时候回车键有点问题，因为没有对\n进行处理</strong></p>
<p>其实这些操作都是在考虑一个消息该怎么处理</p>
<ol>
<li>要确定响应什么消息，像鼠标按下，就是lbuttondown</li>
<li>添加消息响应函数，快捷方式从消息中add</li>
<li>追加消息响应内容，默认是空的，你要给这个消息额外写一些功能</li>
</ol>
<p>其中比较麻烦的就是确定响应哪个消息，一开始肯定是不知道了只能查了。还有就是响应规则，有些会和头部预先定义的相关，有些则是全都由自己来写。</p>
<p>那么现在还有两个问题，一个多行文本一个光标移动。</p>
<p>换行这个问题其实根本在TextOut上，因为这个方法不具备换行能力。而我们又要考虑重绘的问题，就需要在OnDraw里改动。<br>最简单的就是用循环，然后if判断输入的是是否为换行，如果是就要让TextOut的y轴变大。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(PS_DASH, <span class="number">4</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CPen *pPen = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;pen);</span><br><span class="line">	<span class="function">CBrush <span class="title">brush</span><span class="params">(RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CBrush *pBrush = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;brush);</span><br><span class="line"></span><br><span class="line">	LOGPEN logpen;</span><br><span class="line">	pPen-&gt;<span class="built_in">GetLogPen</span>(&amp;logpen);</span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;\nstyle:%d width:%d color:%08X\n&quot;</span>, logpen.lopnStyle, logpen.lopnWidth, logpen.lopnColor);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;	</span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_cur), &amp;brush);</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_stop), &amp;brush);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//还原笔的属性是为了保证后面要画的时候不会还是这个属性的笔</span></span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pPen);</span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pBrush);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//重绘字符串</span></span><br><span class="line">	CString sub = _T(<span class="string">&quot;&quot;</span>);	<span class="comment">//用来记录要绘制的字符</span></span><br><span class="line">	<span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">0</span>; i &lt; m_strText.<span class="built_in">GetLength</span>(); i++ ) &#123;</span><br><span class="line">		<span class="keyword">if</span> (( m_strText.<span class="built_in">GetAt</span>(i) == <span class="string">&#x27;\n&#x27;</span> ) || (m_strText.<span class="built_in">GetAt</span>(i) == <span class="string">&#x27;\r&#x27;</span>)) &#123;</span><br><span class="line">			pDC-&gt;<span class="built_in">TextOut</span>(<span class="number">0</span>, y, sub);</span><br><span class="line">			sub.<span class="built_in">Empty</span>();</span><br><span class="line">			y += <span class="number">20</span>;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		sub += m_strText.<span class="built_in">GetAt</span>(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//sub不为空就直接打印</span></span><br><span class="line">	<span class="keyword">if</span> ( !sub.<span class="built_in">IsEmpty</span>() ) pDC-&gt;<span class="built_in">TextOut</span>(<span class="number">0</span>, y, sub);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2022/07/25/mfc01/027.png" class="">
<p>换行的效果实现了，这里比较坑的是<code>if (( m_strText.GetAt(i) == &#39;\n&#39; ) || (m_strText.GetAt(i) == &#39;\r&#39;))</code>获取的换行符好像会被\r顶掉，但是\n还是得保留，因为键盘输入的角度都是\r了，但是万一黏贴的文本是个\n就有点搞了。<br>不过显然是获取数据的时候有点小问题，要是不想在这if，可能就要在onchar消息里面修改掉。</p>
<p>最后就是光标</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDraw</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CMFCPaintDoc* pDoc = <span class="built_in">GetDocument</span>();</span><br><span class="line">	<span class="built_in">ASSERT_VALID</span>(pDoc);</span><br><span class="line">	<span class="keyword">if</span> (!pDoc)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处为本机数据添加绘制代码</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(PS_DASH, <span class="number">4</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CPen *pPen = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;pen);</span><br><span class="line">	<span class="function">CBrush <span class="title">brush</span><span class="params">(RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	CBrush *pBrush = pDC-&gt;<span class="built_in">SelectObject</span>(&amp;brush);</span><br><span class="line"></span><br><span class="line">	LOGPEN logpen;</span><br><span class="line">	pPen-&gt;<span class="built_in">GetLogPen</span>(&amp;logpen);</span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;\nstyle:%d width:%d color:%08X\n&quot;</span>, logpen.lopnStyle, logpen.lopnWidth, logpen.lopnColor);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_status)&#123;	</span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_cur), &amp;brush);</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		pDC-&gt;<span class="built_in">FillRect</span>(<span class="built_in">CRect</span>(m_start, m_stop), &amp;brush);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//还原笔的属性是为了保证后面要画的时候不会还是这个类型</span></span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pPen);</span><br><span class="line">	pDC-&gt;<span class="built_in">SelectObject</span>(pBrush);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//重绘字符串</span></span><br><span class="line">	CString sub = _T(<span class="string">&quot;&quot;</span>);	<span class="comment">//用来记录要绘制的字符</span></span><br><span class="line">	<span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> ( <span class="type">int</span> i = <span class="number">0</span>; i &lt; m_strText.<span class="built_in">GetLength</span>(); i++ ) &#123;</span><br><span class="line">		<span class="keyword">if</span> (( m_strText.<span class="built_in">GetAt</span>(i) == <span class="string">&#x27;\n&#x27;</span> ) || (m_strText.<span class="built_in">GetAt</span>(i) == <span class="string">&#x27;\r&#x27;</span>)) &#123;</span><br><span class="line">			pDC-&gt;<span class="built_in">TextOut</span>(<span class="number">0</span>, y, sub);</span><br><span class="line">			CSize sz = pDC-&gt;<span class="built_in">GetTextExtent</span>(sub);</span><br><span class="line">			sub.<span class="built_in">Empty</span>();</span><br><span class="line">			<span class="comment">//y += 20;</span></span><br><span class="line">			y += sz.cy + <span class="number">2</span>;		<span class="comment">//+2是为了留点行间距</span></span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		sub += m_strText.<span class="built_in">GetAt</span>(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//循环里面</span></span><br><span class="line">	<span class="keyword">if</span> ( !sub.<span class="built_in">IsEmpty</span>() ) pDC-&gt;<span class="built_in">TextOut</span>(<span class="number">0</span>, y, sub);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//移动光标</span></span><br><span class="line">	CPoint cp;</span><br><span class="line">	CSize sz = pDC-&gt;<span class="built_in">GetTextExtent</span>(sub);</span><br><span class="line">	cp.y = y;		<span class="comment">//y是局部设置好的</span></span><br><span class="line">	cp.x = sz.cx;	<span class="comment">//通过捕捉sub，得到x和y</span></span><br><span class="line">	<span class="built_in">SetCaretPos</span>(cp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>光标的y轴还算好计算的，毕竟换行的时候就会根据y改变<br>x则需要借助<code>CSize sz = pDC-&gt;GetTextExtent(sub);</code>这么一个获取设备上下文的文字范围。其中最为关键的就是cx和cy。<br>所以也修改了换行的时候y的值，但从20这个固定值，只能保证常用字符，有些汉字什么的就不能保证了，所以还是主动获取最好。</p>
<p><strong>要注意，换行前的xy和换行后的xy肯定是不同的，不要想着用一个CSize</strong></p>
<img src="/2022/07/25/mfc01/028.png" class="">
<p>效果差不多了。</p>
<p>像玩的深入的还能这样该后面的移动光标<br><code>SetCaretPos(CPoint(sz.cx + 2, y));</code><br>一句话就该过去了，实际上也是用了父类子类之间的关系，然后就是构造函数。<br>看了老师的操作雀食不一样，还有一种调用系统api的方式<code>::SetCaretPos(sz.cx + 2, y);</code>，不过毕竟是系统api，不是mfc的直接内容，所以有的时候为了项目维护还是不搞花里胡哨的。</p>
<p>但是仍然有很多不足</p>
<ol>
<li>没有删除的功能</li>
<li>比如左键拖动选中文字，文字的背景颜色会变黑之类的</li>
</ol>
<p>这些日后再说</p>
<hr>
<h2 id="菜单和工具栏"><a href="#菜单和工具栏" class="headerlink" title="菜单和工具栏"></a>菜单和工具栏</h2><h3 id="菜单栏"><a href="#菜单栏" class="headerlink" title="菜单栏"></a>菜单栏</h3><img src="/2022/07/25/mfc01/029.png" class="">
<p>资源视图没有的，在vs的菜单栏找到视图，再找其他窗口里面就有了。</p>
<p>然后就是经典设计，注意修改id，默认尾巴跟数字不利于使用和查看。然后描述文字<code>画矩形(&amp;R)</code>后面的是快捷键的一种表达方式，反正具体的应该是mfc写好了。我们只要跟着这样格式写就行。alt+你所输入的字符即为快捷键</p>
<img src="/2022/07/25/mfc01/030.png" class="">
<p>跑起来效果肯定就没啥差别</p>
<img src="/2022/07/25/mfc01/031.png" class="">
<p>灰色应该是没有事件处理，就是死的按钮。</p>
<p>然后就是给这个菜单绑定事件</p>
<img src="/2022/07/25/mfc01/032.png" class="">
<p>类别表选择view。看下面的菜单命令路由</p>
<img src="/2022/07/25/mfc01/033.png" class="">

<p>确定之后就会加载一个空的函数了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDrawLine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加命令处理程序代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TRACE(&quot;%s(%d):%s\r\n&quot;, __FILE__, __LINE__, __FUNCTION__);</code><br>这条内容主要是打印文件路径，然后行号，还有就是函数名<br>典型的debug调试时候使用。</p>
<p>我们把画矩形绑定事件，不同的就是类列表不同，前面那个在view下，这个在doc下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintDoc::OnDrwaRect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此添加命令处理程序代码</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s\r\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后run一个<br>当我们点击了这个画线和画矩形的时候，输出那里就能看到详细的文件路径、行号和函数名</p>
<img src="/2022/07/25/mfc01/034.png" class="">

<p>有意思的是双击输出中的这一行TRACE打印的内容他会直接跳转到这个函数的位置</p>
<img src="/2022/07/25/mfc01/035.png" class="">

<p>对于测试来说这个肯定挺好用的。</p>
<hr>
<h3 id="菜单命令路由"><a href="#菜单命令路由" class="headerlink" title="菜单命令路由"></a>菜单命令路由</h3><ol>
<li>有view和doc，触发了view，但是没有触发doc</li>
<li>去掉view类的菜单响应函数，打开doc类的响应函数。触发view类，不触发doc；view &gt; doc</li>
<li>去掉了doc类的菜单响应函数，打开框架类的响应函数触发doc类，不触发app；doc &gt; 框架</li>
<li>去掉了app类的菜单响应函数，打开app类的响应函数； 框架 &gt; app</li>
</ol>
<p>所以响应菜单的命令顺序：view &gt; doc &gt; 框架 &gt; app<br>在这个mfc程序里面看：CMFCPaintView &gt; CMFCPaintDoc &gt; CMainFrame &gt; CMFCPanitApp</p>
<p>测试的方式可以通过<code>TRACE(&quot;%s(%d):%s\r\n&quot;, __FILE__, __LINE__, __FUNCTION__);</code><br>在view中都绑定事件，然后在其它doc下也绑定，看看到底先触发的是view还是什么。</p>
<p><strong>经典MVC模式中，M是指业务模型，V是指用户界面，C则是控制器，使用MVC的目的是将M和V的实现代码分离，从而使同一个程序可以使用不同的表现形式。其中，View的定义比较清晰，就是用户界面。</strong></p>
<hr>
<h3 id="工具栏"><a href="#工具栏" class="headerlink" title="工具栏"></a>工具栏</h3><p>也是通过资源视图去找，找到toolbar，然后叫mainframe</p>
<img src="/2022/07/25/mfc01/036.png" class="">
<img src="/2022/07/25/mfc01/037.png" class="">
<p>下面哪个256是因为有别的颜色，但是本身都是一个东西，所以做一个东西俩都要弄</p>
<img src="/2022/07/25/mfc01/038.png" class="">
<img src="/2022/07/25/mfc01/039.png" class="">
<p>绘制完成后，修改id</p>
<img src="/2022/07/25/mfc01/040.png" class="">

<p><strong>注意，如果这个id选择的是以前写过内容的id，那么这个工具栏的按钮就会绑定之前的内容</strong><br>比如我这个又使用<code>DRAW_LINE</code>这是之前测试的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCPaintView::OnDrawLine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加命令处理程序代码</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s\r\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内容是这样的，我们run这个程序点击看看是否会触发</p>
<img src="/2022/07/25/mfc01/041.png" class="">
<p>我们点击了三次，它也的确触发了三次，说明确实绑定了。</p>
<p><strong>删除这个工具栏的选项，要点击然后拖出去就能删掉了，默认没啥地方有删除选项</strong></p>
<hr>
<h3 id="mfc结构文档"><a href="#mfc结构文档" class="headerlink" title="mfc结构文档"></a>mfc结构文档</h3><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/cpp/mfc/hierarchy-chart?view=msvc-170&viewFallbackFrom=2022">文档戳链接，如果有误跳转时可修改最后参数，此参数为年份</a></p>
<p>看层次结构的目的是为了以后当参数转换啥的更方便，像自己在vs里面不断跳转定义也ok，就是稍微麻烦了点。</p>
<p>层次的视觉感观会更直接，比如生物-动物-人-男人，作为派生类，总会有一些与其父类相关的特性。</p>
<p>CObject</p>
<ul>
<li>支持序列化<ul>
<li>可能把一个结构体变成一个字符串，几个字节存放一个数据，最后留俩当长度</li>
<li>也可能是{x:100,y:200}这样结构化，类似于json</li>
<li>….等都是一种序列化的表现</li>
</ul>
</li>
<li>支持运行时提供类的信息<ul>
<li><code>static CRuntimeClass *PASCAL _GetBaseClass();</code></li>
<li><code>static CRuntimeClass *PASCAL GetThisClass();</code></li>
<li>正常的派生类下来，并不会刻意保留父类叫什么，而mfc做了一些优化</li>
</ul>
</li>
<li>支持动态创建以及支持对象诊断输出<ul>
<li><code>virtual void AsserValid() const;</code></li>
<li><code>virtual void Dump(CDumpContext&amp; dc) const;</code></li>
<li>当mfc启动时，有些需求不是立马就创建的，只有当触发的时候才会创建</li>
</ul>
</li>
</ul>
<p>有这么一个超级基类的存在，就提供了无限的可能，但是这种级别的东西不适合个人开发。</p>
<hr>
<h2 id="mfc框架理论"><a href="#mfc框架理论" class="headerlink" title="mfc框架理论"></a>mfc框架理论</h2><h3 id="关键类"><a href="#关键类" class="headerlink" title="关键类"></a>关键类</h3><p><code>CWinApp</code>:MFC应用程序抽象，负责管理Document Template<br><code>CFrameWnd</code>:框架窗口、负责创建应用的主窗口，含标题栏、菜单栏、工具栏、状态栏等<br><code>CView</code>:负责展示应用数据，View其实是一个没有边框的窗口，客户区<br><code>CDocument</code>:负责存储应用数据</p>
<hr>
<h3 id="关键类之间的关系"><a href="#关键类之间的关系" class="headerlink" title="关键类之间的关系"></a>关键类之间的关系</h3><p>CDocTemplate、CDocument、CView、CFrameWnd关系</p>
<ul>
<li>CWinApp 拥有一个对象指针：CDocManager *m_pDocManager</li>
<li>CDocManager拥有一个指针链表CPtrList m_templateList，用来维护一系列的DocumentTemplate。应用程序在CMyWinApp::InitInstance中以AddDocTemplate将这些Document Templates加入到有CDocTemplate所维护的链表之中</li>
<li>CDocTemplate拥有三个成员变量，分别持有Document、View、Frame的CRuntimeClass指针，另有一个成员变量m_nIDResource，用来表示此Document显示时应该采用的UI对象。这四位数据在CMyWinApp::InitInstance函数构造CDocTemplate时指针，称为构造函数的参数。</li>
<li>CDocument有一个成员变量CDocTemplate *m_pDocTemplate，回指其DocumentTemplate；另外有一个成员变量CPtrList m_viewList，表示它可以同时维护一组Views。</li>
<li>CFrameWnd有一个成员变量Cview *m_pViewActive，指向当前活动的View</li>
<li>CView有一个成员变量CDocument *m_pDocument，指向相关的Document</li>
</ul>
<p>结构层次化都是为了方便开发和维护。</p>
<hr>
<h3 id="消息分类"><a href="#消息分类" class="headerlink" title="消息分类"></a>消息分类</h3><p>mfc消息的分类大致分为三种：标准消息、命令消息、通告消息。</p>
<ol>
<li>标准消息：除WM_COMMAND之外，所有以WM_开头的消息。从CWnd类派生的类都可以接受到这一类消息</li>
<li>命令消息：来自菜单、加速键或者工具栏按钮的消息。这类消息都以WM_COMMAND呈现。在MFC中，通过菜单项的标识(id)来区分不同的命令消息；在sdk中，通过消息的wParam参数识别。从CCmdTarget(CWnd的父类)派生的类都可以接收到这一类消息</li>
<li>通告消息：由控件产生的消息，例如按钮的单击，列表框的选择等均会产生此类消息，为的是向其父窗口(通常为对话框)通知时间的发生。这类消息也是以WM_COMMAND形式呈现。从CCmdTarget(CWnd的父类)派生的类都可以接收到这一类消息。</li>
</ol>
<p>小结：凡是从Cwnd派生的类，即可以接受标准消息，也可以接收命令消息和通告消息。<br>而对于那些从CCmdTarget派生的类，则只能接受命令消息和通告消息，不能接受标准消息。</p>
<hr>
<h2 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h2><p>是与用户进行交互的控件，如文件对话框、字体对话框、颜色对话框等，一般用于告示、提醒等。</p>
<img src="/2022/07/25/mfc01/042.png" class="">
<p>app这个是之前创建的对话框，从类视图可以看到只有三个类。比文档的结构观感上要简洁不少。</p>
<p>其中标准消息可以直接通过类视图-&gt;选择项目的类-&gt;属性里面找到消息即可。</p>
<p>对话框其实就是一个窗口，它不仅可以接收消息，而且还可以被移动或者关闭，甚至是在客户区中进行绘图。这些都是有CWnd类派生而来。</p>
<img src="/2022/07/25/mfc01/043.png" class="">

<p>其中除了最基础的消息，还有控件</p>
<img src="/2022/07/25/mfc01/044.png" class="">
<p>利用拖动控件的方式，可以省去很多麻烦。</p>
<hr>
<h3 id="创建对话框"><a href="#创建对话框" class="headerlink" title="创建对话框"></a>创建对话框</h3><p>同样的，已有的几个是根据项目类型产生的，我们当然可以进行创建<br>在资源视图中，选这个项目的Dialog，然后右击添加资源</p>
<img src="/2022/07/25/mfc01/045.png" class="">

<p>这里不选子类直接选Dialog也是可以的。</p>
<img src="/2022/07/25/mfc01/046.png" class="">
<p>通过Dialog创建的它的对话框属性只有一个id能修改，问题不大，改个有意义的就行</p>
<img src="/2022/07/25/mfc01/047.png" class="">
<p>资源属性这边能改的就很多。</p>
<p>图形化的做完了，代码实现部分就需要类去控制它</p>
<img src="/2022/07/25/mfc01/048.png" class="">
<p>直接右击添加类，类名随便写尽量有意义，然后继承的基类，一般是这头两个。ex说过就是拓展的意思。</p>
<p>这种通过简单的方式创建出模板的好处就是省去了一些小麻烦，也不容易出问题</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCApplication1Dlg::OnBnClickedOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="comment">//MessageBox(_T(&quot;你好呀!&quot;));</span></span><br><span class="line">	CBingDialog dlg;</span><br><span class="line">	dlg.<span class="built_in">DoModal</span>();</span><br><span class="line">	</span><br><span class="line">	CDialogEx::<span class="built_in">OnOK</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在主窗口的确认按钮下设置，将我们新建的CBingDialog作为模块化弹出</p>
<img src="/2022/07/25/mfc01/049.png" class="">
<p>当dlg弹出之后，原先的窗口是不可改变的状态，只有dlg关闭之后才能操作后面的对话框。</p>
<p><code>DoModal</code>这就是所谓的模态对话框，有的时候会觉得不太方便吧，但是如果是警示之类的还是挺好的。</p>
<p>有模态化就有非模态化的，非模态化的一个问题其实猜也能猜到，就是因非模态化而产生的对话框不会卡住，如果这个变量优先级不够，很有可能在不知道的地方就被析构释放了，在逻辑上会导致很严重的问题，而且设置起来也较为麻烦。</p>
<p><strong>首先因为没有锁或者说阻塞，所以当按钮按下的适合，这个新建的对话框一闪而过，结束的很快。</strong><br>所以要在头文件类中建一个全局变量。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CMFCApplication1Dlg</span> : <span class="keyword">public</span> CDialogEx</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 构造</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CMFCApplication1Dlg</span>(CWnd* pParent = <span class="literal">nullptr</span>);	<span class="comment">// 标准构造函数</span></span><br><span class="line">	CBingDialog dlg;		<span class="comment">//注意引用头文件不然是未定义的类型</span></span><br><span class="line"><span class="comment">//....后面的省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后又要在对话框源文件中，找到oninitdialog函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class="line">dlg.<span class="built_in">Create</span>(IDD_DIALOG_NEW, <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<p>在这完成初始化。</p>
<p>最后在按钮消息中触发显示</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCApplication1Dlg::OnBnClickedOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	dlg.<span class="built_in">ShowWindow</span>(SW_SHOW);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到非模态化的对话框设置起来就要挺多步骤了。</p>
<img src="/2022/07/25/mfc01/050.png" class="">
<p>非模态化的效果就是不会阻塞，后面的窗口是可以操作的。</p>
<p>或者你可以直接在对话框源文件中定义全局变量<code>CBingDialog dlg;</code><br>然后再按钮消息中设置</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCApplication1Dlg::OnBnClickedOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	dlg.<span class="built_in">Create</span>(IDD_DIALOG_NEW, <span class="keyword">this</span>);</span><br><span class="line">	dlg.<span class="built_in">ShowWindow</span>(SW_SHOW);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也是可行的，因为这个dlg变量不会再按钮结束后立马被析构掉。</p>
<p><strong>总而言是，模态化对话框的使用场景肯定是基于会修改影响到其他窗口，这个时候肯定要设置称模态化对话框去阻塞，不然改动了还原的部分都没的操作了。非模态像vs的视图吧，这些对话框不会直接影响主窗口的就适用于非模态</strong></p>
<hr>
<h3 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h3><p>按钮的创建，从图形化角度，直接拖动控件是最直接的，拖动完成后保存，然后双击这个按钮直接会跳转到代码界面，你就可以编辑这个按钮消息能干什么了。</p>
<img src="/2022/07/25/mfc01/051.png" class="">
<p>新建一个按钮，修改一下描述文字和id，然后双击开始编辑</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedButtonTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>老样子在日志里输出文件路径，行号，函数名。</p>
<img src="/2022/07/25/mfc01/052.png" class="">
<p>这玩意肯定是不会有啥问题了。</p>
<img src="/2022/07/25/mfc01/053.png" class="">
<p>至于动态布局，就是比例放大或者缩小的适合这个按钮的位置会自动调整，不设置的话窗口放大或者缩小它的位置都不会改变。</p>
<p>其它的一些行为都有中文描述可以自己试一下。</p>
<p>然后就是通过按钮去创建自定义按钮，本质上就是手动整活了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	CButton m_Btn;		<span class="comment">//自定义按钮</span></span><br></pre></td></tr></table></figure>
<p>在头文件中肯定要预先定义这个空的按钮。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedButtonTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( m_Btn.m_hWnd == <span class="literal">NULL</span> ) &#123;</span><br><span class="line">		m_Btn.<span class="built_in">Create</span>(_T(<span class="string">&quot;动态&quot;</span>), BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD, <span class="built_in">CRect</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">150</span>), <span class="keyword">this</span>, <span class="number">9999</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD</code><br>BS开头就是button style，按钮自带的样式，WS就是 windows style，译为windows系统的样式，具体种类可以转到定义，有不少这样的类型。</p>
<p><strong>注意下最后的id，不要通过变量传递去改变，一定要固定为主，避免冲突或者广播，因为id重了，获取消息的时候就可能一起接收或者发送</strong></p>
<img src="/2022/07/25/mfc01/054.png" class="">
<p>跑起来之后，点击test_button之后就会弹出这个动态的按钮，看上去可能有点潦草，毕竟是随便建的。</p>
<blockquote>
<p>如果采用全局变量dlg是在源文件的要注意一下<br>可能存在窗口创建多次报错</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCApplication1Dlg::OnBnClickedOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( dlg.m_hWnd == <span class="literal">NULL</span> ) &#123;</span><br><span class="line">		dlg.<span class="built_in">Create</span>(IDD_DIALOG_NEW, <span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	dlg.<span class="built_in">ShowWindow</span>(SW_SHOW);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给他加个验证以防万一</p>
<p><strong>动态按钮的创建，还是随着用户改变为主，一般用的少</strong><br>不过没启用之前也不占资源倒是一件好事，顶多留个指针。</p>
<hr>
<h2 id="控件"><a href="#控件" class="headerlink" title="控件"></a>控件</h2><p>正常情况下，我们知道访问这个控件，比如按钮，肯定是在当前窗口访问最直接也不需要额外操作，但是别的窗口如果要访问，就是另一回事了。</p>
<img src="/2022/07/25/mfc01/055.png" class="">
<p>首先给这个对话框里面添加三个文本框，默认是空的，通过别的地方传递给这个文本框一个初始值。</p>
<p>在自定义的对话框初始化一个文本框之前需要注意，我们自定义的他少一个标准的函数<code>OnInitDialog()</code>作为初始化用</p>
<p>打开类视图-&gt;找到这个项目选择CBingDialog-&gt;然后属性那边有个重写往下滑找到<code>OnInitDialog()</code>点击后面add即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CBingDialog::OnInitDialog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span>  在此添加额外的初始化</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE unless you set the focus to a control</span></span><br><span class="line">				  <span class="comment">// 异常: OCX 属性页应返回 FALSE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="访问文本框"><a href="#访问文本框" class="headerlink" title="访问文本框"></a>访问文本框</h3><p>通过父类CWnd，我们可以直接在对话框初始化这些文本框</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CBingDialog::OnInitDialog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span>  在此添加额外的初始化</span></span><br><span class="line">	CWnd *pEdit01 = <span class="built_in">GetDlgItem</span>(IDC_EDIT_ONE);</span><br><span class="line">	CWnd *pEdit02 = <span class="built_in">GetDlgItem</span>(IDC_EDIT_TWO);</span><br><span class="line">	CWnd *pEdit03 = <span class="built_in">GetDlgItem</span>(IDC_EDIT_THREE);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( pEdit01 != <span class="literal">NULL</span> ) pEdit01-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;100&quot;</span>));</span><br><span class="line">	<span class="keyword">if</span> ( pEdit02 != <span class="literal">NULL</span> ) pEdit02-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;200&quot;</span>));</span><br><span class="line">	<span class="keyword">if</span> ( pEdit03 != <span class="literal">NULL</span> ) pEdit03-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;300&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE unless you set the focus to a control</span></span><br><span class="line">				  <span class="comment">// 异常: OCX 属性页应返回 FALSE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/056.png" class="">

<p>这个setwindowstext不仅能设置，还能取出值，类型应是Cstring</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CString setText;</span><br><span class="line">pEdit01-&gt;<span class="built_in">SetWindowText</span>(strText);</span><br></pre></td></tr></table></figure>

<p>用父类的CWnd去接收可能有点麻烦，但是至少能判断是否获取成功了<br>因为还有一种直接的方式</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetDlgItemText</span>(IDC_EDIT_ONE, _T(<span class="string">&quot;100&quot;</span>));</span><br><span class="line"><span class="built_in">GetDlgItemText</span>(IDC_EDIT_ONE, strText);</span><br></pre></td></tr></table></figure>
<p>这种方式呢，主要是产生错误的时候你也不晓得是前者不存在，还是后者溢出。</p>
<p>还有一种是针对无符号整型的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetDlgItemInt</span>(IDC_EDIT_THREE, <span class="number">300</span>);</span><br><span class="line">BOOL isTrans = FALSE;</span><br><span class="line">UINT ret = <span class="built_in">GetDlgItemINt</span>(IDC_EDIT_THREE, &amp;isTrans);</span><br></pre></td></tr></table></figure>
<p>加这个布尔值的意思是，如果传输成功，这个布尔值就会变成TRUE，那么ret的值自然就是300，到不太在意ret了，如果还是FALSE，则说明传递失败了。</p>
<hr>
<h3 id="添加变量"><a href="#添加变量" class="headerlink" title="添加变量"></a>添加变量</h3><p>先去Diglog页面，选中文本框右击，添加变量打开即可。</p>
<img src="/2022/07/25/mfc01/057.png" class="">
<p>选择类别，一种是值一种是控件，这边现用值，名称看着来。<br>选择类别为值后，变量的类型也需要确定，默认来说字符串Cstring更合适，这边先用int玩，注释就更不用说了。</p>
<img src="/2022/07/25/mfc01/058.png" class="">
<p>选择int这种值类型，在其他这里就会有最小值和最大值的分别。最大字符数是给字符串类型用的，至于下面的文件倒不用特意选了，毕竟这个添加变量是在CBingDialog下添加的，默认就在这里。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;afxdialogex.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CBingDialog 对话框</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CBingDialog</span> : <span class="keyword">public</span> CDialogEx</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">DECLARE_DYNAMIC</span>(CBingDialog)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CBingDialog</span>(CWnd* pParent = <span class="literal">nullptr</span>);   <span class="comment">// 标准构造函数</span></span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CBingDialog</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对话框数据</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class="line">	<span class="keyword">enum</span> &#123; IDD = IDD_DIALOG_NEW &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	CButton m_Btn;		<span class="comment">//自定义按钮</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span>;    <span class="comment">// DDX/DDV 支持</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">afx_msg <span class="type">void</span> <span class="title">OnBnClickedButtonTest</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> BOOL <span class="title">OnInitDialog</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 文本框1的值</span></span><br><span class="line">    <span class="type">int</span> m_Value1;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>能看到下面有个注释，然后是我们新增的变量。<br>在源文件中同样有初始化的地方</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::DoDataExchange</span><span class="params">(CDataExchange* pDX)</span> </span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">DoDataExchange</span>(pDX);</span><br><span class="line">	<span class="built_in">DDX_Text</span>(pDX, IDC_EDIT_ONE, m_Value1);</span><br><span class="line">	<span class="built_in">DDV_MinMaxInt</span>(pDX, m_Value1, <span class="number">-9999</span>, <span class="number">9999</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>别的不说，这个绑定在文本框的id和名称，还有下面的最大值最小值肯定看得出来。</p>
<p><strong>那么肯定会好奇绑定这个值类型的变量有什么用？</strong></p>
<p>给另外两个文本框都添加变量<br>然后给确定按钮写代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();					<span class="comment">//无参数默认为TRUE，此时把界面的值传到变量</span></span><br><span class="line">	m_Value3 = m_Value1 + m_Value2;</span><br><span class="line">	<span class="built_in">UpdateData</span>(FALSE);				<span class="comment">//为FALASE时，把值传回到界面</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//CDialogEx::OnOK();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就是按下之后，文本框三的内容是1+2的就对了。<br>这里随便修改一下文本框2的内容，然后再按下确认，能看到文本框3的内容改变了</p>
<img src="/2022/07/25/mfc01/059.png" class="">

<hr>
<h3 id="添加控件"><a href="#添加控件" class="headerlink" title="添加控件"></a>添加控件</h3><p>方法一致，在Dialog视图中右击文本框添加变量，只不过类型改成控件<br>当三个都添加完成之后编写代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line"></span><br><span class="line">	CString str1, str2, str3;</span><br><span class="line">	m_Edit1.<span class="built_in">GetWindowText</span>(str1);</span><br><span class="line">	m_Edit2.<span class="built_in">GetWindowText</span>(str2);</span><br><span class="line">	<span class="type">int</span> t = _wtoi(str1) + _wtoi(str2);</span><br><span class="line">	TCHAR buf[<span class="number">32</span>] = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	_itow_s(t, buf, <span class="number">10</span>);</span><br><span class="line">	str3 = buf;</span><br><span class="line">	m_Edit3.<span class="built_in">SetWindowText</span>(str3);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//CDialogEx::OnOK();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>控件创建的时候变量类型是CEdit，那么推测也是跟字符串有关的，所以在做加法之前先完成一个转换。<br>最后得到的结果也是成功的</p>
<img src="/2022/07/25/mfc01/060.png" class="">
<p>虽然肯能不是很实用，但是总归是个小技巧</p>
<hr>
<h3 id="SendMessage"><a href="#SendMessage" class="headerlink" title="SendMessage"></a>SendMessage</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SendMessage</span>(WM_GETTEXT);</span><br><span class="line"><span class="built_in">SendMessage</span>(WM_SETTEXT);</span><br></pre></td></tr></table></figure>
<p>不过这俩在函数内部，其实也不知道发给谁，顶多是传给往上一层的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedButtonTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( m_Btn.m_hWnd == <span class="literal">NULL</span> ) &#123;</span><br><span class="line">		m_Btn.<span class="built_in">Create</span>(_T(<span class="string">&quot;动态&quot;</span>), BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD, <span class="built_in">CRect</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">150</span>), <span class="keyword">this</span>, <span class="number">9999</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	TCHAR buf[<span class="number">20</span>] = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	::<span class="built_in">SendMessage</span>(m_Edit1.m_hWnd, WM_GETTEXT, <span class="number">20</span>, (LPARAM)buf);</span><br><span class="line">	m_Edit1.<span class="built_in">SendMessage</span>(WM_SETTEXT, <span class="built_in">sizeof</span>(buf), (LPARAM)buf);</span><br><span class="line">	<span class="built_in">SendMessage</span>(WM_GETTEXT, <span class="number">20</span>, (LPARAM)buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>老实说这后面的在干什么我也看不懂了。<br>不过打断点调试之后，看到buf的值是取了这个窗口的标题</p>
<img src="/2022/07/25/mfc01/061.png" class="">

<p>不过按照推理<code>m_Edit1.m_hWnd</code>这个应该是通过控件获取到这个当前窗口句柄了，然后get句柄的Text属性到buf上，之所以能找到这个窗口句柄感觉还是因为<code>::</code>全局作用域的关系，然后后面这个文本框发送消息到buf上这个说法上不太通顺，因为用文本框发送消息和按钮按下后发送消息，buf理论都一样了吧，毕竟是从窗口句柄取值的。</p>
<p><strong>打个？后面碰到了在细究</strong></p>
<hr>
<h2 id="对话框伸缩"><a href="#对话框伸缩" class="headerlink" title="对话框伸缩"></a>对话框伸缩</h2><p>其实窗口是有自带的缩放，但是这里先自定义两个按钮去实现</p>
<img src="/2022/07/25/mfc01/062.png" class="">
<p>控件拖动完毕后，修改一下id，然后双击按钮跳到代码编辑部分。</p>
<p>放大还是缩小总归是要知道窗口的大小先</p>
<p>现在头文件里预定一大一小</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//窗口大小</span></span><br><span class="line">CRect m_large;</span><br><span class="line">CRect m_small;</span><br></pre></td></tr></table></figure>
<p><strong>注：CRect有四个成员分别是left,top这二者代表矩形左上角顶点坐标，right，bottom代表矩形右下角的坐标，草图如下：</strong></p>
<img src="/2022/07/25/mfc01/068.png" class="">


<p>然后在源文件的<code>OnInitDialog()</code>初始化一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GetWindowRect</span>(m_large);</span><br><span class="line">m_small = m_large;</span><br><span class="line">m_small.right = m_small.left + m_small.<span class="built_in">Width</span>() / <span class="number">2</span>;</span><br><span class="line">m_small.bottom = m_small.top + m_small.<span class="built_in">Height</span>() / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>最后给放大缩小实现一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedBtnLarge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CRect curRect;		<span class="comment">//获取当前窗口尺寸信息</span></span><br><span class="line">	<span class="built_in">GetWindowRect</span>(curRect);</span><br><span class="line">	<span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, curRect.left, curRect.top,</span><br><span class="line">				 m_large.<span class="built_in">Width</span>(), m_large.<span class="built_in">Height</span>(),</span><br><span class="line">				 SWP_NOMOVE | SWP_NOZORDER</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedBtnSmall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CRect curRect;</span><br><span class="line">	<span class="built_in">GetWindowRect</span>(curRect);</span><br><span class="line">	<span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, curRect.left, curRect.top,</span><br><span class="line">				 m_small.<span class="built_in">Width</span>(), m_small.<span class="built_in">Height</span>(),</span><br><span class="line">				 SWP_NOMOVE | SWP_NOZORDER</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>SWP_NOZORDER：忽略第一个参数；SWP_NOMOVE：忽略x、y，维持位置不变</strong></p>
<p>curRect都是为了先获取当前窗口尺寸<br>所以当setwindowpos的时候，xy不需要改变，cx和cy则是用m_large和m_small改变。<br>不过因为m_large初始化的时候是直接根据当前窗口大小来的，所以一开始点击放大是没有反应的，当缩小了之后在点击放大才会改变回原有尺寸</p>
<img src="/2022/07/25/mfc01/063.png" class="">
<p>这里调整了一下俩按钮的位置，因为没有加滑动条，所以缩小了原有位置就够不到了。</p>
<img src="/2022/07/25/mfc01/064.png" class="">

<p>不过可以看出上述按钮实现雷同点比较多。<br>那么就有一个骚操作，就是通过获取按钮标签名去改变</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedBtnLarge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CRect curRect;		<span class="comment">//获取当前窗口尺寸信息</span></span><br><span class="line">	<span class="built_in">GetWindowRect</span>(curRect);</span><br><span class="line"></span><br><span class="line">	CWnd *pButton = <span class="built_in">GetDlgItem</span>(IDC_BTN_LARGE);</span><br><span class="line">	CString strTitle;</span><br><span class="line">	<span class="keyword">if</span> ( pButton ) &#123;</span><br><span class="line">		pButton-&gt;<span class="built_in">GetWindowText</span>(strTitle);</span><br><span class="line">		<span class="keyword">if</span> ( strTitle == _T(<span class="string">&quot;放大&quot;</span>) ) &#123;</span><br><span class="line">			pButton-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;缩小&quot;</span>));</span><br><span class="line"></span><br><span class="line">			<span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, curRect.left, curRect.top,</span><br><span class="line">				 m_large.<span class="built_in">Width</span>(), m_large.<span class="built_in">Height</span>(),</span><br><span class="line">				 SWP_NOMOVE | SWP_NOZORDER</span><br><span class="line">			);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			pButton-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;放大&quot;</span>));</span><br><span class="line"></span><br><span class="line">			<span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, curRect.left, curRect.top,</span><br><span class="line">				m_small.<span class="built_in">Width</span>(), m_small.<span class="built_in">Height</span>(),</span><br><span class="line">				SWP_NOMOVE | SWP_NOZORDER</span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/065.png" class="">
<img src="/2022/07/25/mfc01/066.png" class="">
<img src="/2022/07/25/mfc01/067.png" class="">

<p>先点击放大，发现按钮名变成缩小了，然后再次点击，窗口缩小，按钮名称变成放大，再点击就放大了，按钮名称就变成缩小。</p>
<p>所以另一个按钮就没有存在的必要了，把这个放大按钮的名称改成缩小，这样一来开头的光变名字就可以省去了。</p>
<p>最后做一个安全的设计</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CBingDialog::OnBnClickedBtnLarge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CRect curRect;		<span class="comment">//获取当前窗口尺寸信息</span></span><br><span class="line">	<span class="built_in">GetWindowRect</span>(curRect);</span><br><span class="line"></span><br><span class="line">	CWnd *pButton = <span class="built_in">GetDlgItem</span>(IDC_BTN_LARGE);</span><br><span class="line">	CString strTitle;</span><br><span class="line">	<span class="keyword">if</span> ( pButton ) &#123;</span><br><span class="line">		pButton-&gt;<span class="built_in">GetWindowText</span>(strTitle);</span><br><span class="line">		<span class="keyword">if</span> ( strTitle == _T(<span class="string">&quot;放大&quot;</span>) &amp;&amp; (m_large.<span class="built_in">IsRectEmpty</span>() == FALSE) ) &#123;</span><br><span class="line">			pButton-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;缩小&quot;</span>));</span><br><span class="line"></span><br><span class="line">			<span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, curRect.left, curRect.top,</span><br><span class="line">				 m_large.<span class="built_in">Width</span>(), m_large.<span class="built_in">Height</span>(),</span><br><span class="line">				 SWP_NOMOVE | SWP_NOZORDER</span><br><span class="line">			);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( m_large.<span class="built_in">IsRectEmpty</span>() == FALSE ) &#123;</span><br><span class="line">			pButton-&gt;<span class="built_in">SetWindowText</span>(_T(<span class="string">&quot;放大&quot;</span>));</span><br><span class="line"></span><br><span class="line">			<span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, curRect.left, curRect.top,</span><br><span class="line">				m_small.<span class="built_in">Width</span>(), m_small.<span class="built_in">Height</span>(),</span><br><span class="line">				SWP_NOMOVE | SWP_NOZORDER</span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>IsRectEmpty()</code>主要是为了判断这个窗口如果left、top、right、bottom都一样的话，说明这个窗口就只有一个点，并没有办法完成缩放和放大了。</p>
<blockquote>
<p>窗口其实除了大小，就是绘制的位置，有的时候不是在当前窗口之上绘制，就有可能掉下去一层跟后面的窗口平级，至于窗口为什么能叠加，应该是除了xy，还有一个z轴，是3d模型的经典概念。</p>
</blockquote>
<hr>
<h2 id="常用控件"><a href="#常用控件" class="headerlink" title="常用控件"></a>常用控件</h2><p>空间交互，首先要创建控件或者说拖个出来，交互，就需要绑定控件或者变量，在消息中有来有回实现一些功能。</p>
<p>例如上述所学到的函数<code>GetDlgItem</code>，他就可以通过控件id获取到对应的控件<br><code>CListBox *list  = (CListBox*)GetDlgItem(控件id)</code></p>
<p>绑定控件和变量，在消息中曾使用到<code>UpdateData(TRUE|FALSE)</code>，默认不填写为TRUE，也就是将控件内容第一时间同步到变量上，FALSE则是将变量同步回控件</p>
<hr>
<h3 id="Radio"><a href="#Radio" class="headerlink" title="Radio"></a>Radio</h3><p>随便建个mfc项目，选择对话框类型，有的没的取消勾选</p>
<img src="/2022/07/25/mfc01/069.png" class="">

<p>然后绘制这样的窗口，其中radio和check按钮，最后一个button</p>
<p>性别直接添加一个变量就可以了，原本想着用bool类型，但是考虑到得有个初始值，其实这个初始化关系到也不是特别大，但此处就换个万一弄弄，用int来表示，那么就需要注意了，你需要修改初始化部分</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CMFCButtonDlg::<span class="built_in">CMFCButtonDlg</span>(CWnd* pParent <span class="comment">/*=nullptr*/</span>)</span><br><span class="line">	: <span class="built_in">CDialogEx</span>(IDD_MFCBUTTON_DIALOG, pParent)</span><br><span class="line">    , <span class="built_in">m_sex</span>(<span class="number">-1</span>)&#123;</span><br><span class="line">	m_hIcon = <span class="built_in">AfxGetApp</span>()-&gt;<span class="built_in">LoadIcon</span>(IDR_MAINFRAME);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>m_sex为我们添加的变量名，括号代表初始化值，默认是0，但这里的思路是-1为未初始化，0为男 1为女这样。</p>
<p>如此一来，结果那个按钮第一步就可以上手了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_sex == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;请选择性别&quot;</span>), _T(<span class="string">&quot;性别缺失&quot;</span>), MB_OK | MB_ICONEXCLAMATION);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>_T只是为了兼容unicode，在你的项目编码是ANSI的时候下次转换能保证字符串不出错，其次还有一个_L，它是不管编译方式都按unicode保存</strong></p>
<p><strong>万国码通用保存2两字节，ANSI英文一字节汉语两字节，再次强调</strong></p>
<p><code>MB_ICONEXCLAMATION</code>是一个警告图标，不同于<code>SWP_NOZORDER</code>，前者为黄色感叹号，后者为红色x号。</p>
<p>然后打印，肯定就要用CString了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_sex == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;请选择性别&quot;</span>), _T(<span class="string">&quot;性别缺失&quot;</span>), MB_OK | MB_ICONEXCLAMATION);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CString strMsg = _T(<span class="string">&quot;您的性别是：&quot;</span>) + (m_sex == <span class="number">0</span>) ? _T(<span class="string">&quot;男\n&quot;</span>) : _T(<span class="string">&quot;女\n&quot;</span>);</span><br><span class="line">	<span class="built_in">MessageBox</span>(strMsg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>run的时候会发现</p>
<img src="/2022/07/25/mfc01/070.png" class="">
<p>额前面那句好像没有加上，原因应该是Cstring没有重写string+string吧</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_sex == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;请选择性别&quot;</span>), _T(<span class="string">&quot;性别缺失&quot;</span>), MB_OK | MB_ICONEXCLAMATION);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CString strMsg = <span class="built_in">CString</span>(_T(<span class="string">&quot;您的性别是：&quot;</span>)) + ((m_sex == <span class="number">0</span>) ? _T(<span class="string">&quot;男\n&quot;</span>) : _T(<span class="string">&quot;女\n&quot;</span>));</span><br><span class="line">	<span class="built_in">MessageBox</span>(strMsg, _T(<span class="string">&quot;tips&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改之后：</p>
<img src="/2022/07/25/mfc01/071.png" class="">


<p>对于多选框，类型一般还是bool比较合适，但是默认的添加变量都是单个类型，所以我们在自动的基础上，给他改成数组</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 爱好</span></span><br><span class="line">BOOL m_hobby[<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<p>那么在源文件就要注意：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CMFCButtonDlg::<span class="built_in">CMFCButtonDlg</span>(CWnd* pParent <span class="comment">/*=nullptr*/</span>)</span><br><span class="line">	: <span class="built_in">CDialogEx</span>(IDD_MFCBUTTON_DIALOG, pParent)</span><br><span class="line">    , <span class="built_in">m_sex</span>(<span class="number">-1</span>) &#123;</span><br><span class="line">	<span class="built_in">memset</span>(m_hobby, <span class="number">0</span>, <span class="built_in">sizeof</span>(m_hobby));</span><br><span class="line"></span><br><span class="line">	m_hIcon = <span class="built_in">AfxGetApp</span>()-&gt;<span class="built_in">LoadIcon</span>(IDR_MAINFRAME);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">DoDataExchange</span>(pDX);</span><br><span class="line">	<span class="built_in">DDX_Radio</span>(pDX, IDC_RAD_MAN, m_sex);</span><br><span class="line">	<span class="built_in">DDX_Check</span>(pDX, IDC_CK_FB, m_hobby[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">DDX_Check</span>(pDX, IDC_CK_BKB, m_hobby[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">DDX_Check</span>(pDX, IDC_CK_YOGA, m_hobby[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>手动修改成数组</p>
<p>最后完善一下结果消息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_sex == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;请选择性别&quot;</span>), _T(<span class="string">&quot;性别缺失&quot;</span>), MB_OK | MB_ICONEXCLAMATION);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CString strMsg = <span class="built_in">CString</span>(_T(<span class="string">&quot;您的性别是：&quot;</span>)) + ((m_sex == <span class="number">0</span>) ? _T(<span class="string">&quot;男\n&quot;</span>) : _T(<span class="string">&quot;女\n&quot;</span>));</span><br><span class="line">	strMsg += _T(<span class="string">&quot;你的爱好有：&quot;</span>);</span><br><span class="line">	CString hobby[<span class="number">3</span>]&#123; _T(<span class="string">&quot;足球&quot;</span>),_T(<span class="string">&quot;篮球&quot;</span>),_T(<span class="string">&quot;瑜伽&quot;</span>) &#125;;</span><br><span class="line">	<span class="keyword">for</span>( <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ )&#123;</span><br><span class="line">		<span class="keyword">if</span>( m_hobby[i] )&#123;</span><br><span class="line">			strMsg += hobby[i] + _T(<span class="string">&quot; &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">MessageBox</span>(strMsg, _T(<span class="string">&quot;tips&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/072.png" class="">
<p>就ok了，这两个按钮的应用还算基础的。</p>
<p>当然自己定义数组一个办法，也可以通过控件id，get他的name<br>至于说这个id该通过什么办法<br>比如项目头文件里面有个叫<code>Resource.h</code>的，打开之后会看到他宏定义了我们跟控件有关的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IDD_MFCBUTTON_DIALOG            102</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDR_MAINFRAME                   128</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_BUTTON1                     1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_BTN_RESULT                  1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_RAD_MAN                     1001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_RAD_WOMEN                   1002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_CK_FB                       1003</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_CK_BKB                      1004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IDC_CK_YOGA                     1005</span></span><br></pre></td></tr></table></figure>
<p>复选框就看后面仨，有了这个其实会容易很多，因为他们是连续的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_sex == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;请选择性别&quot;</span>), _T(<span class="string">&quot;性别缺失&quot;</span>), MB_OK | MB_ICONEXCLAMATION);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CString strMsg = <span class="built_in">CString</span>(_T(<span class="string">&quot;您的性别是：&quot;</span>)) + ((m_sex == <span class="number">0</span>) ? _T(<span class="string">&quot;男\n&quot;</span>) : _T(<span class="string">&quot;女\n&quot;</span>));</span><br><span class="line">	strMsg += _T(<span class="string">&quot;你的爱好有：&quot;</span>);</span><br><span class="line">	<span class="comment">//CString hobby[3]&#123; _T(&quot;足球&quot;),_T(&quot;篮球&quot;),_T(&quot;瑜伽&quot;) &#125;;</span></span><br><span class="line"></span><br><span class="line">	UINT nId = IDC_CK_FB;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>( <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ )&#123;</span><br><span class="line">		<span class="keyword">if</span>( m_hobby[i] )&#123;</span><br><span class="line">			<span class="comment">//strMsg += hobby[i] + _T(&quot; &quot;);</span></span><br><span class="line">			CString sName;</span><br><span class="line">			<span class="built_in">GetDlgItemText</span>(nId + i, sName);</span><br><span class="line">			strMsg += sName;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">MessageBox</span>(strMsg, _T(<span class="string">&quot;tips&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为从足球开始，后面只需要+1就可以得到，倒是省了定义一个数组。</p>
<img src="/2022/07/25/mfc01/073.png" class="">

<p><strong>但是这个是基于你这几个复选框是连续的，id才能跟的上，不然跟数组没啥太大差别</strong></p>
<hr>
<h3 id="EditControl"><a href="#EditControl" class="headerlink" title="EditControl"></a>EditControl</h3><p>工具箱里找</p>
<img src="/2022/07/25/mfc01/074.png" class="">
<p>然后拖出来，稍微调整一下大小</p>
<img src="/2022/07/25/mfc01/075.png" class="">

<p>对应的属性也有不少，好在2022都做成中文了</p>
<img src="/2022/07/25/mfc01/076.png" class="">

<p>这玩意说实在没啥必要演示，自己试几下就行了，但是有个基础应用的地方到时跟上面能联动<br>就是将我们选完之后的内容打印在editcontrol中</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">UpdateData</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_sex == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;请选择性别&quot;</span>), _T(<span class="string">&quot;性别缺失&quot;</span>), MB_OK | MB_ICONEXCLAMATION);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CString strMsg = <span class="built_in">CString</span>(_T(<span class="string">&quot;您的性别是：&quot;</span>)) + ((m_sex == <span class="number">0</span>) ? _T(<span class="string">&quot;男\r\n&quot;</span>) : _T(<span class="string">&quot;女\r\n&quot;</span>));</span><br><span class="line">	strMsg += _T(<span class="string">&quot;你的爱好有：&quot;</span>);</span><br><span class="line">	<span class="comment">//CString hobby[3]&#123; _T(&quot;足球&quot;),_T(&quot;篮球&quot;),_T(&quot;瑜伽&quot;) &#125;;</span></span><br><span class="line"></span><br><span class="line">	UINT nId = IDC_CK_FB;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>( <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ )&#123;</span><br><span class="line">		<span class="keyword">if</span>( m_hobby[i] )&#123;</span><br><span class="line">			<span class="comment">//strMsg += hobby[i] + _T(&quot; &quot;);</span></span><br><span class="line">			CString sName;</span><br><span class="line">			<span class="built_in">GetDlgItemText</span>(nId + i, sName);</span><br><span class="line">			strMsg += sName;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CEdit* edit = (CEdit*)<span class="built_in">GetDlgItem</span>(IDC_EDIT1);</span><br><span class="line">	<span class="comment">//edit-&gt;GetWindowTextW();</span></span><br><span class="line">	edit-&gt;<span class="built_in">SetWindowText</span>(strMsg);		<span class="comment">//设置文本</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">MessageBox</span>(strMsg, _T(<span class="string">&quot;tips&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中要注意editcontrol属性要设置几个地方</p>
<ol>
<li>多行 true</li>
<li>想要返回 true</li>
<li>就是写入的strMsg想要换行，要在中间加<code>\r\n</code>，单纯的<code>\n</code>好像不起作用</li>
</ol>
<p>效果就是如下：</p>
<img src="/2022/07/25/mfc01/077.png" class="">
<p>点击完成后往edit里面写入，和弹出对话框</p>
<img src="/2022/07/25/mfc01/078.png" class="">

<hr>
<h3 id="ListBox"><a href="#ListBox" class="headerlink" title="ListBox"></a>ListBox</h3><p>老样子在dialog界面打开工具箱，找到listbox</p>
<img src="/2022/07/25/mfc01/079.png" class="">
<p>然后属性都是中文名了，实在不行点击一下下面还有介绍，再不济就自己修改试试</p>
<img src="/2022/07/25/mfc01/080.png" class="">


<p>随便搞个例子试试</p>
<img src="/2022/07/25/mfc01/082.png" class="">
<p>先绘制这样的界面，然后就是往里面addsttring，最后根据选中的返回结果这样。</p>
<blockquote>
<p>别忘了给listbox添加变量</p>
</blockquote>
<p>双击test按钮</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CString strText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( m_conmpany.<span class="built_in">GetSelCount</span>() == <span class="number">0</span> )&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(_T(<span class="string">&quot;没有选中任何公司&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="type">int</span> total = m_conmpany.<span class="built_in">GetSelCount</span>();</span><br><span class="line">		<span class="type">int</span>* index = <span class="keyword">new</span> <span class="type">int</span>[total];</span><br><span class="line">		strText += _T(<span class="string">&quot;您选中了&quot;</span>);</span><br><span class="line">		TCHAR buf[<span class="number">32</span>] = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		_itow_s(total, buf, <span class="number">32</span>, <span class="number">10</span>);</span><br><span class="line">		strText += buf;</span><br><span class="line">		strText += _T(<span class="string">&quot;个公司\n&quot;</span>);</span><br><span class="line">		m_conmpany.<span class="built_in">GetSelItems</span>(total, index);</span><br><span class="line"></span><br><span class="line">		CString strTmp;</span><br><span class="line">		<span class="keyword">for</span>( <span class="type">int</span> i = <span class="number">0</span>; i &lt; total; i++ )&#123;</span><br><span class="line">			m_conmpany.<span class="built_in">GetText</span>(index[i], strTmp);</span><br><span class="line">			strText += strTmp + _T(<span class="string">&quot; &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">delete</span>[] index;</span><br><span class="line">		<span class="built_in">MessageBox</span>(strText);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>m_conmpany</code>为我们给listbox这个控件设置的变量。<br>首要判断就是是否选中，选中之后在循环接收。</p>
<p>别忘了在<code>oninitdialog</code>里面初始化一下这个listbox。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CMFCButtonDlg::OnInitDialog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class="line">	<span class="comment">//  执行此操作</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, TRUE);			<span class="comment">// 设置大图标</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, FALSE);		<span class="comment">// 设置小图标</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;山东蓝翔&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;深圳电子厂&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;义乌商超&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2022/07/25/mfc01/081.png" class="">
<p>效果也不难，就是一些常规操作。</p>
<hr>
<h3 id="Combox"><a href="#Combox" class="headerlink" title="Combox"></a>Combox</h3><img src="/2022/07/25/mfc01/083.png" class="">
<img src="/2022/07/25/mfc01/084.png" class="">
<p>拖出两个控件<br>数据在</p>
<img src="/2022/07/25/mfc01/085.png" class="">
<p>依旧是用分号阻隔。</p>
<img src="/2022/07/25/mfc01/086.png" class="">
<p>样式有三个，除了这个simple特殊一点，因为他不会显示箭头，你选中之后可以通过方向键控制。<br>或者它的神奇之处。。</p>
<img src="/2022/07/25/mfc01/087.png" class="">
<p>你可以在dialog里从下面拉大这个combox，这样他在run的时候就能把在长度之内的列显示出来，虽然有点二。</p>
<p>当然这种测试都是取出值来玩玩</p>
<img src="/2022/07/25/mfc01/088.png" class="">
<p>左边样式为simple，添加变量<br>右边样式为下拉列表，添加变量<br>然后拖一个按钮，测试用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnDroplist</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="type">int</span> cur = m_simple.<span class="built_in">GetCurSel</span>();</span><br><span class="line">	<span class="keyword">if</span>( cur == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):当前没有选中任何列\n&quot;</span>, __FILE__, __LINE__);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):当前选中了第%d列\n&quot;</span>, __FILE__, __LINE__, cur);</span><br><span class="line">		CString tmp;</span><br><span class="line"></span><br><span class="line">		m_simple.<span class="built_in">GetLBText</span>(cur, tmp);</span><br><span class="line">		<span class="built_in">MessageBox</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也比较简单</p>
<img src="/2022/07/25/mfc01/089.png" class="">
<p>我们选中哪个就messagebox弹出哪个，并且TRACE在日志打印，注意列之类的遵循从0开始计数。</p>
<p>那么还有一个下拉列表，直接套前面那个combox也无伤大雅</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnDroplist</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="type">int</span> cur = m_simple.<span class="built_in">GetCurSel</span>();</span><br><span class="line">	<span class="keyword">if</span>( cur == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):当前没有选中任何列\n&quot;</span>, __FILE__, __LINE__);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):当前选中了第%d列\n&quot;</span>, __FILE__, __LINE__, cur);</span><br><span class="line">		CString tmp;</span><br><span class="line"></span><br><span class="line">		m_simple.<span class="built_in">GetLBText</span>(cur, tmp);</span><br><span class="line">		<span class="built_in">MessageBox</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cur = m_droplist.<span class="built_in">GetCurSel</span>();</span><br><span class="line">	<span class="keyword">if</span>( cur == <span class="number">-1</span> )&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):当前没有选中任何列\n&quot;</span>, __FILE__, __LINE__);</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):当前选中了第%d列\n&quot;</span>, __FILE__, __LINE__, cur);</span><br><span class="line">		CString tmp;</span><br><span class="line"></span><br><span class="line">		m_droplist.<span class="built_in">GetLBText</span>(cur, tmp);</span><br><span class="line">		<span class="built_in">MessageBox</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/090.png" class="">
<p>能看到日志打印的时候，因为m_simple没有选中过，所以会打印未选中任何列，但是后者m_droplist有选中，就有回执信息。</p>
<blockquote>
<p>能get的东西挺多的，用到了翻翻文档就行</p>
</blockquote>
<hr>
<h3 id="Progress"><a href="#Progress" class="headerlink" title="Progress"></a>Progress</h3><p>Progress：进度条<br>一般是要配合定时器去用会好点。</p>
<img src="/2022/07/25/mfc01/091.png" class="">
<p>当然这玩意在dialog界面看着有点效果，但实际你自己没写，他就是空的。</p>
<p>初始化：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CMFCButtonDlg::OnInitDialog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class="line">	<span class="comment">//  执行此操作</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, TRUE);			<span class="comment">// 设置大图标</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, FALSE);		<span class="comment">// 设置小图标</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;山东蓝翔&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;深圳电子厂&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;义乌商超&quot;</span>));</span><br><span class="line"></span><br><span class="line">	m_progress.<span class="built_in">SetRange</span>(<span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然有的时候虽然范围可能是整数，但是步长不一样。</p>
<p>给他加个按钮控制增长。<br><strong>注意改成竖状的时候需要修改进度条外观属性的垂直设置为True</strong></p>
<p>然后双击按钮</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnPrg</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="type">int</span> pos = m_progress.<span class="built_in">GetPos</span>();</span><br><span class="line">	m_progress.<span class="built_in">SetPos</span>(pos + <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取初始的时候，然后每次增加100，反正上限1000，10次就到顶了</p>
<img src="/2022/07/25/mfc01/092.png" class="">
<img src="/2022/07/25/mfc01/093.png" class="">

<p>当然实际用途不会蠢蠢的给用户去点击，肯定是要与计时器绑定。<br>选中对话框找到消息里面的Timer</p>
<img src="/2022/07/25/mfc01/094.png" class="">

<p>在头文件中应该预设一个进度值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进度</span></span><br><span class="line"><span class="type">int</span> m_progress_pos;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CMFCButtonDlg::OnInitDialog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class="line">	<span class="comment">//  执行此操作</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, TRUE);			<span class="comment">// 设置大图标</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, FALSE);		<span class="comment">// 设置小图标</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;山东蓝翔&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;深圳电子厂&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;义乌商超&quot;</span>));</span><br><span class="line"></span><br><span class="line">	m_progress.<span class="built_in">SetRange</span>(<span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">	m_progress_pos = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定时器尽量不要低于30ms，不同机子有少许差别，源自mfc的精度不足导致定时器缺陷</span></span><br><span class="line">	<span class="built_in">SetTimer</span>(<span class="number">99</span>, <span class="number">500</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">SetTimer</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>初始化设置定时器的时候要注意，因为mfc分层，不同机子处理速度不同，所以定时器精度不要设置太小，以免出现误差。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnTimer</span><span class="params">(UINT_PTR nIDEvent)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>( nIDEvent == <span class="number">99</span> )&#123;</span><br><span class="line">		m_progress.<span class="built_in">SetPos</span>(m_progress_pos);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>( nIDEvent == <span class="number">10</span> )&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">GetTickCount</span>());</span><br><span class="line">		<span class="keyword">if</span>( count &gt; <span class="number">5</span> ) <span class="built_in">KillTimer</span>(<span class="number">10</span>);</span><br><span class="line">		count++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CDialogEx::<span class="built_in">OnTimer</span>(nIDEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/095.png" class="">
<p>当我们的间隔设置在5，他的误差还在10左右，拉高之后</p>
<img src="/2022/07/25/mfc01/096.png" class="">
<p><strong>反正就是突出mfc对于定时精度处理不足的问题</strong></p>
<p>那么接下来让他自己动~</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnTimer</span><span class="params">(UINT_PTR nIDEvent)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>( nIDEvent == <span class="number">99</span> )&#123;</span><br><span class="line">		m_progress.<span class="built_in">SetPos</span>(m_progress_pos);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>( nIDEvent == <span class="number">10</span> )&#123;</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">GetTickCount</span>());</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> low, upper;</span><br><span class="line">		m_progress.<span class="built_in">GetRange</span>(low, upper);</span><br><span class="line">		<span class="keyword">if</span>( m_progress_pos &gt;= upper )&#123;</span><br><span class="line">			<span class="built_in">KillTimer</span>(<span class="number">10</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">			m_progress_pos += <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CDialogEx::<span class="built_in">OnTimer</span>(nIDEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要也就是获取这个进度的范围，没到头就慢慢网上递增，像复制文件的话，还得在里面计算文件复制到哪了，然后按比例递增效果更明显。</p>
<img src="/2022/07/25/mfc01/097.png" class="">
<p>静态的图片看不出效果。</p>
<blockquote>
<p>这是演示从空到满的情况，相反的，进度的初始值要改成上限，然后这里改成-&#x3D;10<br>理论就是如此，实现另说</p>
</blockquote>
<p><strong>哈哈，关于这个进度条，千万不要用多个线程去玩。。不然效果很出奇玩自己了属于是</strong></p>
<hr>
<h3 id="图片资源"><a href="#图片资源" class="headerlink" title="图片资源"></a>图片资源</h3><p>也是拖出一个picture control。</p>
<img src="/2022/07/25/mfc01/098.png" class="">
<p>有意思的是命名直接是static，和之前的静态文本框有点相似</p>
<img src="/2022/07/25/mfc01/099.png" class="">
<p>拖个静态文本框可以看到有点相同</p>
<img src="/2022/07/25/mfc01/100.png" class="">

<p>反正父类总有一个是一样的。</p>
<p>控制这些玩意就老样子添加变量&#x2F;控件，添加完之后自然没啥效果。。都没把图片塞进去</p>
<p>点击dialog，从消息里面找到</p>
<img src="/2022/07/25/mfc01/101.png" class="">
<p>file就是跟文件相关的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnDropFiles</span><span class="params">(HDROP hDropInfo)</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="type">int</span> count = <span class="built_in">DragQueryFile</span>(hDropInfo, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//count &gt; 1 Msg..</span></span><br><span class="line">	TCHAR sPath[MAX_PATH];</span><br><span class="line">	<span class="type">char</span> mbsPath[MAX_PATH * <span class="number">2</span>];</span><br><span class="line">	<span class="keyword">for</span>( <span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i++ )&#123;</span><br><span class="line">		<span class="built_in">memset</span>(sPath, <span class="number">0</span>, <span class="built_in">sizeof</span>(sPath));</span><br><span class="line">		<span class="built_in">memset</span>(mbsPath, <span class="number">0</span>, <span class="built_in">sizeof</span>(mbsPath));</span><br><span class="line">		<span class="built_in">DragQueryFile</span>(hDropInfo, i, sPath, MAX_PATH);</span><br><span class="line">		<span class="type">size_t</span> total = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">wcstombs_s</span>(&amp;total, mbsPath, <span class="built_in">sizeof</span>(mbsPath), sPath, MAX_PATH);</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d):%s %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, mbsPath);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>( <span class="built_in">CString</span>(sPath).<span class="built_in">Find</span>(_T(<span class="string">&quot;.ico&quot;</span>)) )&#123;</span><br><span class="line">			HICON hicon = (HICON)<span class="built_in">LoadImage</span>(<span class="built_in">AfxGetInstanceHandle</span>(), sPath, IMAGE_ICON, <span class="number">0</span>, <span class="number">0</span>, LR_LOADFROMFILE | LR_DEFAULTSIZE);</span><br><span class="line">			m_pictrue.<span class="built_in">SetIcon</span>(hicon);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">InvalidateRect</span>(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	CDialogEx::<span class="built_in">OnDropFiles</span>(hDropInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写完之后有一个地方需要注意，因为这个用的图片类型是<code>.ico</code>想直接用mfc那个图片了，所以要修改图片框的类型</p>
<img src="/2022/07/25/mfc01/102.png" class="">
<p>将其修改完之后</p>
<img src="/2022/07/25/mfc01/103.png" class="">
<p>看到样式发生了变化，有点小</p>
<p>右击打开项目的路径，找到res文件夹，里面就有个mfc的ico</p>
<img src="/2022/07/25/mfc01/104.png" class="">

<p>刚开始运行的时候，是看不到图片框的</p>
<img src="/2022/07/25/mfc01/105.png" class="">

<p>这里忘了一个事，就是设置对话框可接受文件</p>
<img src="/2022/07/25/mfc01/107.png" class="">
<p>不设置为true的话，图片拖动是禁止的。</p>
<p>设置true之后拖动图片到对话框上，发现的确显示了。</p>
<img src="/2022/07/25/mfc01/106.png" class="">

<p>并且，日志也输出了这个图片的路径</p>
<img src="/2022/07/25/mfc01/108.png" class="">

<hr>
<h3 id="List-Control"><a href="#List-Control" class="headerlink" title="List Control"></a>List Control</h3><img src="/2022/07/25/mfc01/109.png" class="">
<p>长的吧跟列表又有点相似。倒是多了图标</p>
<img src="/2022/07/25/mfc01/110.png" class="">
<p>其中有几种可选，默认为icon样式</p>
<p>在list视图下就真的跟列表一样了。</p>
<img src="/2022/07/25/mfc01/111.png" class="">

<p>report视图感觉会用的多一点</p>
<img src="/2022/07/25/mfc01/112.png" class="">

<p>这里先用report，为这个控件添加变量，然后初始化一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CMFCButtonDlg::OnInitDialog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class="line">	<span class="comment">//  执行此操作</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, TRUE);			<span class="comment">// 设置大图标</span></span><br><span class="line">	<span class="built_in">SetIcon</span>(m_hIcon, FALSE);		<span class="comment">// 设置小图标</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;山东蓝翔&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;深圳电子厂&quot;</span>));</span><br><span class="line">	m_conmpany.<span class="built_in">AddString</span>(_T(<span class="string">&quot;义乌商超&quot;</span>));</span><br><span class="line"></span><br><span class="line">	m_progress.<span class="built_in">SetRange</span>(<span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">	m_progress_pos = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//定时器尽量不要低于30ms，不同机子有少许差别，源自mfc的精度不足导致定时器缺陷</span></span><br><span class="line">	<span class="built_in">SetTimer</span>(<span class="number">99</span>, <span class="number">500</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">SetTimer</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化列</span></span><br><span class="line">	m_list.<span class="built_in">InsertColumn</span>(<span class="number">0</span>, _T(<span class="string">&quot;序号&quot;</span>));</span><br><span class="line">	m_list.<span class="built_in">InsertColumn</span>(<span class="number">1</span>, _T(<span class="string">&quot;IP&quot;</span>));</span><br><span class="line">	m_list.<span class="built_in">InsertColumn</span>(<span class="number">2</span>, _T(<span class="string">&quot;ID&quot;</span>));</span><br><span class="line">	m_list.<span class="built_in">InsertColumn</span>(<span class="number">3</span>, _T(<span class="string">&quot;CHECK&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/113.png" class="">
<p>设置文字是没啥问题了，但是一开始他都是缩在一团还要拉开太麻烦了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m_list.<span class="built_in">InsertColumn</span>(<span class="number">0</span>, _T(<span class="string">&quot;序号&quot;</span>), LVCFMT_LEFT, <span class="number">50</span>);</span><br><span class="line">m_list.<span class="built_in">InsertColumn</span>(<span class="number">1</span>, _T(<span class="string">&quot;IP&quot;</span>), LVCFMT_LEFT, <span class="number">200</span>);</span><br><span class="line">m_list.<span class="built_in">InsertColumn</span>(<span class="number">2</span>, _T(<span class="string">&quot;ID&quot;</span>), LVCFMT_LEFT, <span class="number">180</span>);</span><br><span class="line">m_list.<span class="built_in">InsertColumn</span>(<span class="number">3</span>, _T(<span class="string">&quot;CHECK&quot;</span>), LVCFMT_LEFT, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>
<p>修改完之后，其实还要调整一下list control在对话框里面的大小</p>
<img src="/2022/07/25/mfc01/114.png" class="">
<p>目前来说调整成这样差不多。再不济，空间有限的情况下，给他上滚动条</p>
<p>除此之外也可以用代码实现改变style，同样在初始化的地方</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DWORD extStyle = m_list.<span class="built_in">GetExtendedStyle</span>();</span><br><span class="line">extStyle |= LVS_EX_FULLROWSELECT;</span><br><span class="line">extStyle |= LVS_EX_GRIDLINES;</span><br><span class="line">m_list.<span class="built_in">SetExtendedStyle</span>(extStyle);</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/115.png" class="">
<p>多了点格子，目前还没有数据</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//列增加数据</span></span><br><span class="line">m_list.<span class="built_in">InsertItem</span>(<span class="number">0</span>, <span class="built_in">CString</span>(<span class="string">&quot;0&quot;</span>));</span><br><span class="line">m_list.<span class="built_in">SetItemText</span>(<span class="number">0</span>, <span class="number">1</span>, _T(<span class="string">&quot;192.168.0.1&quot;</span>));</span><br><span class="line">m_list.<span class="built_in">SetItemText</span>(<span class="number">0</span>, <span class="number">2</span>, _T(<span class="string">&quot;6648964896486480&quot;</span>));</span><br><span class="line">m_list.<span class="built_in">SetItemText</span>(<span class="number">0</span>, <span class="number">3</span>, _T(<span class="string">&quot;999&quot;</span>));</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/116.png" class="">
<p>虽然能设置，但是总归是麻烦了一点。</p>
<p>另外背景颜色。。额没这个本事，用参数调得不得行</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_list.<span class="built_in">SetBkColor</span>(<span class="built_in">RGB</span>(<span class="number">64</span>, <span class="number">255</span>, <span class="number">128</span>));</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/117.png" class="">
<p>哈哈哈瞎调的，辣眼睛还是注释了先。</p>
<p>列表比较实用的也可以像多选那样，在初始化的地方给list加个样式</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extStyle |= LVS_EX_CHECKBOXES;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/118.png" class="">
<p>可以看到多了多选框</p>
<p>那么首先要拖个按钮测试选中之后拉取数据</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnList</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="type">int</span> lineCount = m_list.<span class="built_in">GetItemCount</span>();</span><br><span class="line">	CHeaderCtrl* pHeader = m_list.<span class="built_in">GetHeaderCtrl</span>();</span><br><span class="line">	<span class="type">int</span> coloumnCount = pHeader-&gt;<span class="built_in">GetItemCount</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lineCount; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; coloumnCount; j++) &#123;</span><br><span class="line">			CString temp = m_list.<span class="built_in">GetItemText</span>(i, j);</span><br><span class="line">			<span class="type">char</span> Text[MAX_PATH];</span><br><span class="line">			<span class="built_in">memset</span>(Text, <span class="number">0</span>, <span class="built_in">sizeof</span>(Text));</span><br><span class="line">			<span class="type">size_t</span> total;</span><br><span class="line">			<span class="built_in">wcstombs_s</span>(&amp;total, Text, <span class="built_in">sizeof</span>(Text), temp, temp.<span class="built_in">GetLength</span>());</span><br><span class="line">			<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d): %s %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, Text);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/119.png" class="">
<p>可以看到日志输出了我们所选的行的数据。</p>
<p>如何把多选框和数据关联<br>显然就是判断</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnBnClickedBtnList</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="type">int</span> lineCount = m_list.<span class="built_in">GetItemCount</span>();</span><br><span class="line">	CHeaderCtrl* pHeader = m_list.<span class="built_in">GetHeaderCtrl</span>();</span><br><span class="line">	<span class="type">int</span> coloumnCount = pHeader-&gt;<span class="built_in">GetItemCount</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lineCount; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (m_list.<span class="built_in">GetCheck</span>(i)) &#123;</span><br><span class="line">			<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d): %s %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="string">&quot;选中&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d): %s %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="string">&quot;未选中&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; coloumnCount; j++) &#123;</span><br><span class="line">			CString temp = m_list.<span class="built_in">GetItemText</span>(i, j);</span><br><span class="line">			<span class="type">char</span> Text[MAX_PATH];</span><br><span class="line">			<span class="built_in">memset</span>(Text, <span class="number">0</span>, <span class="built_in">sizeof</span>(Text));</span><br><span class="line">			<span class="type">size_t</span> total;</span><br><span class="line">			<span class="built_in">wcstombs_s</span>(&amp;total, Text, <span class="built_in">sizeof</span>(Text), temp, temp.<span class="built_in">GetLength</span>());</span><br><span class="line">			<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d): %s %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, Text);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/120.png" class="">
<p>虽然有点简陋。</p>
<p>关于list的style <code>LVS_EX_</code>还有很多不怎么用的，不过一般也是重写<br>还有些set的方法可以搜一搜看看。</p>
<hr>
<h3 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h3><img src="/2022/07/25/mfc01/121.png" class="">
<p>拖个tree control出来，然后添加个变量<br>且预览效果跟这样差不多，那我们肯定要自己初始化他</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Tree</span></span><br><span class="line">HTREEITEM hRoot = m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;root&quot;</span>));</span><br><span class="line">HTREEITEM hLeaf1 = m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;leaf&quot;</span>), hRoot);</span><br><span class="line">m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;sub&quot;</span>), hLeaf1);</span><br><span class="line">HTREEITEM hLeaf2 = m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;leaf&quot;</span>), hRoot);</span><br><span class="line">m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;sub&quot;</span>), hLeaf2);</span><br></pre></td></tr></table></figure>

<p>根 叶 子叶</p>
<img src="/2022/07/25/mfc01/122.png" class="">
<p>这是全部展开的样子，默认只有root，双击之后一个个展开。光秃秃的很潦草。</p>
<p>图标自己画问题不大，右击项目打开所在路径，找到res文件夹，在里面添加个位图</p>
<img src="/2022/07/25/mfc01/123.png" class="">
<p>这是画完的样子。<br>然后导入资源。</p>
<p><strong>搞这种位图呢，主要是应对需要挺多logo之类简单的图片，文件太散找的麻烦，在一张上做分界标记会更好</strong></p>
<img src="/2022/07/25/mfc01/124.png" class="">

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//头文件声明</span></span><br><span class="line">CImageList m_icons;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//源文件初始化</span></span><br><span class="line">m_icons.<span class="built_in">Create</span>(IDB_TREE, <span class="number">32</span>, <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">m_tree.<span class="built_in">SetImageList</span>(&amp;m_icons, TVSIL_NORMAL);</span><br><span class="line"><span class="comment">//Tree</span></span><br><span class="line">HTREEITEM hRoot = m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;root&quot;</span>), <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">HTREEITEM hLeaf1 = m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;leaf&quot;</span>), <span class="number">2</span>, <span class="number">1</span>, hRoot);</span><br><span class="line">m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;sub&quot;</span>), <span class="number">2</span>, <span class="number">1</span>, hLeaf1);</span><br><span class="line">HTREEITEM hLeaf2 = m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;leaf&quot;</span>), <span class="number">2</span>, <span class="number">1</span>, hRoot);</span><br><span class="line">m_tree.<span class="built_in">InsertItem</span>(_T(<span class="string">&quot;sub&quot;</span>), <span class="number">2</span>, <span class="number">1</span>, hLeaf2);</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/125.png" class="">
<p>哈哈图片画少了，他一个节点两个状态可以用两个图片的，选中和未选中两个样，但是我们用的2和1，所以效果就比较糙。</p>
<img src="/2022/07/25/mfc01/126.png" class="">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CMFCButtonDlg::OnNMDblclkTree</span><span class="params">(NMHDR* pNMHDR, LRESULT* pResult)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	UINT nCount = m_tree.<span class="built_in">GetSelectedCount</span>();</span><br><span class="line">	<span class="keyword">if</span> (nCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		HTREEITEM hSelect = m_tree.<span class="built_in">GetSelectedItem</span>();</span><br><span class="line">		CString strText = m_tree.<span class="built_in">GetItemText</span>(hSelect);</span><br><span class="line">		<span class="type">char</span> sText[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="type">size_t</span> total;</span><br><span class="line">		<span class="built_in">wcstombs_s</span>(&amp;total, sText, <span class="built_in">sizeof</span>(sText), strText, strText.<span class="built_in">GetLength</span>());</span><br><span class="line">		<span class="built_in">TRACE</span>(<span class="string">&quot;%s(%d): %s %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, sText);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	*pResult = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/07/25/mfc01/127.png" class="">
<p>其实做法有很多，大多例子都是颗糖。</p>
<hr>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>MFC看下来跟去年Qt一个感觉吧，知道拖控件和消息之类的，但是实战太少，经验不足，有的时候很难主动把这些关联起来。</p>
<p>至于Qt后面也要重新捯饬捯饬。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://8bytes.top">Box</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://8bytes.top/2022/07/25/mfc01/">https://8bytes.top/2022/07/25/mfc01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://8bytes.top" target="_blank">Box'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MFC/">MFC</a></div><div class="post_share"><div class="social-share" data-image="/images/cover/cover12.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/02/escapeButton/"><img class="prev-cover" src="/images/cover/cover1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">丐版逃跑按钮</div></div></a></div><div class="next-post pull-right"><a href="/2022/07/25/dynamiclink/"><img class="next-cover" src="/images/cover/escr.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">动态链接库</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/10/01/dll%E7%BC%BA%E5%A4%B1/" title="dll缺失"><img class="cover" src="/images/cover/escr.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-01</div><div class="title">dll缺失</div></div></a></div><div><a href="/2022/08/02/escapeButton/" title="丐版逃跑按钮"><img class="cover" src="/images/cover/cover1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-02</div><div class="title">丐版逃跑按钮</div></div></a></div><div><a href="/2022/08/03/nDialog/" title="多个对话框关联"><img class="cover" src="/images/cover/cover1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-03</div><div class="title">多个对话框关联</div></div></a></div><div><a href="/2022/09/15/%E8%BF%9C%E6%8E%A7%E9%97%AE%E9%A2%98%E9%9B%86/" title="远控笔记"><img class="cover" src="/images/cover/cover12.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-15</div><div class="title">远控笔记</div></div></a></div><div><a href="/2022/11/08/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91/" title="音视频开发"><img class="cover" src="/images/cover/cover4.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-08</div><div class="title">音视频开发</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/logo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Box</div><div class="author-info__description">知其不可奈何而安之若命</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">144</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/8bytes-code"><i class="fab fa-github"></i><span>Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">鼠鼠我啊懂点电脑会点C/C++<br/>是一个不够勤快的鼠鼠啊<br/>努力找到自己的下水道吧<br/>鼠鼠的博客挂在GitHub，附带netlify部署</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MFC%E4%B8%BA%E4%BD%95%E7%89%A9"><span class="toc-number">2.1.</span> <span class="toc-text">MFC为何物</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%BA%ABWin32"><span class="toc-number">2.2.</span> <span class="toc-text">前身Win32</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AA%97%E5%8F%A3%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.窗口程序架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-API%E5%92%8CSDK"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.API和SDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%AA%97%E5%8F%A3%E5%92%8C%E5%8F%A5%E6%9F%84"><span class="toc-number">2.2.3.</span> <span class="toc-text">3.窗口和句柄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B6%88%E6%81%AF%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.2.4.</span> <span class="toc-text">4.消息循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A"><span class="toc-number">2.2.5.</span> <span class="toc-text">5.变量命名约定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MFC%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">MFC程序开发流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%AF%9D%E6%A1%86%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">2.3.1.</span> <span class="toc-text">1.基于对话框的程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9F%BA%E4%BA%8E%E6%96%87%E6%A1%A3-x2F-%E8%AF%95%E5%9B%BE%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.基于文档&#x2F;试图的程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-MFC%E4%B8%8Ewin32%E5%BC%80%E5%8F%91%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.MFC与win32开发的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-MFC%E6%B6%88%E6%81%AF%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.4.</span> <span class="toc-text">4.MFC消息映射机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.3.5.</span> <span class="toc-text">5.构建项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%BB%E7%BA%BF"><span class="toc-number">2.4.</span> <span class="toc-text">画线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%BB%E7%AC%94"><span class="toc-number">2.5.</span> <span class="toc-text">画笔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TRACE"><span class="toc-number">2.5.1.</span> <span class="toc-text">TRACE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%BB%E5%88%B7"><span class="toc-number">2.6.</span> <span class="toc-text">画刷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%89%E6%A0%87%E5%92%8C%E6%96%87%E6%9C%AC"><span class="toc-number">2.7.</span> <span class="toc-text">光标和文本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E5%92%8C%E5%B7%A5%E5%85%B7%E6%A0%8F"><span class="toc-number">2.8.</span> <span class="toc-text">菜单和工具栏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E6%A0%8F"><span class="toc-number">2.8.1.</span> <span class="toc-text">菜单栏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E5%91%BD%E4%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">2.8.2.</span> <span class="toc-text">菜单命令路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E6%A0%8F"><span class="toc-number">2.8.3.</span> <span class="toc-text">工具栏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mfc%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3"><span class="toc-number">2.8.4.</span> <span class="toc-text">mfc结构文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mfc%E6%A1%86%E6%9E%B6%E7%90%86%E8%AE%BA"><span class="toc-number">2.9.</span> <span class="toc-text">mfc框架理论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%B1%BB"><span class="toc-number">2.9.1.</span> <span class="toc-text">关键类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%B1%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.9.2.</span> <span class="toc-text">关键类之间的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E5%88%86%E7%B1%BB"><span class="toc-number">2.9.3.</span> <span class="toc-text">消息分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">2.10.</span> <span class="toc-text">对话框</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">2.10.1.</span> <span class="toc-text">创建对话框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%92%AE"><span class="toc-number">2.10.2.</span> <span class="toc-text">按钮</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E4%BB%B6"><span class="toc-number">2.11.</span> <span class="toc-text">控件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%96%87%E6%9C%AC%E6%A1%86"><span class="toc-number">2.11.1.</span> <span class="toc-text">访问文本框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%8F%98%E9%87%8F"><span class="toc-number">2.11.2.</span> <span class="toc-text">添加变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%8E%A7%E4%BB%B6"><span class="toc-number">2.11.3.</span> <span class="toc-text">添加控件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SendMessage"><span class="toc-number">2.11.4.</span> <span class="toc-text">SendMessage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%BC%B8%E7%BC%A9"><span class="toc-number">2.12.</span> <span class="toc-text">对话框伸缩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8E%A7%E4%BB%B6"><span class="toc-number">2.13.</span> <span class="toc-text">常用控件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Radio"><span class="toc-number">2.13.1.</span> <span class="toc-text">Radio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditControl"><span class="toc-number">2.13.2.</span> <span class="toc-text">EditControl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListBox"><span class="toc-number">2.13.3.</span> <span class="toc-text">ListBox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Combox"><span class="toc-number">2.13.4.</span> <span class="toc-text">Combox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Progress"><span class="toc-number">2.13.5.</span> <span class="toc-text">Progress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90"><span class="toc-number">2.13.6.</span> <span class="toc-text">图片资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-Control"><span class="toc-number">2.13.7.</span> <span class="toc-text">List Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tree"><span class="toc-number">2.13.8.</span> <span class="toc-text">Tree</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">3.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/14/Netlify/" title="Netlify+hexo部署"><img src="/images/cover/cover11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netlify+hexo部署"/></a><div class="content"><a class="title" href="/2022/12/14/Netlify/" title="Netlify+hexo部署">Netlify+hexo部署</a><time datetime="2022-12-14T02:41:37.000Z" title="发表于 2022-12-14 10:41:37">2022-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/12/walineErr/" title="waline无法登录(vercel.app被污染)"><img src="/images/cover/escr.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="waline无法登录(vercel.app被污染)"/></a><div class="content"><a class="title" href="/2022/12/12/walineErr/" title="waline无法登录(vercel.app被污染)">waline无法登录(vercel.app被污染)</a><time datetime="2022-12-12T10:48:56.000Z" title="发表于 2022-12-12 18:48:56">2022-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/10/%E6%97%81%E5%90%AC%E9%9D%A2%E8%AF%952-0/" title="get面试2.0"><img src="/images/cover/cover10.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="get面试2.0"/></a><div class="content"><a class="title" href="/2022/12/10/%E6%97%81%E5%90%AC%E9%9D%A2%E8%AF%952-0/" title="get面试2.0">get面试2.0</a><time datetime="2022-12-10T05:59:28.000Z" title="发表于 2022-12-10 13:59:28">2022-12-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/06/chatgpt/" title="chatgpt"><img src="/images/cover/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="chatgpt"/></a><div class="content"><a class="title" href="/2022/12/06/chatgpt/" title="chatgpt">chatgpt</a><time datetime="2022-12-06T12:58:31.000Z" title="发表于 2022-12-06 20:58:31">2022-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/30/vs%E4%B9%B1%E7%A0%81/" title="【软件】vs2022控制台乱码"><img src="/images/cover/cover4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【软件】vs2022控制台乱码"/></a><div class="content"><a class="title" href="/2022/11/30/vs%E4%B9%B1%E7%A0%81/" title="【软件】vs2022控制台乱码">【软件】vs2022控制台乱码</a><time datetime="2022-11-30T11:00:03.000Z" title="发表于 2022-11-30 19:00:03">2022-11-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/cover/cover12.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Box</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">我下班了蟹老板~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadWaline () {
  function insertCSS () {
    const link = document.createElement("link")
    link.rel = "stylesheet"
    link.href = "https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css"
    document.head.appendChild(link)
  }

  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://comments.8bytes.top/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  if (typeof Waline === 'function') initWaline()
  else {
    insertCSS()
    getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
  }
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>